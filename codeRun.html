<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeCraft Pro Runner</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- CodeMirror for better syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/material.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/nord.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/solarized.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/cobalt.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/ayu-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/ayu-mirage.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closetag.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/xml-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/search.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/searchcursor.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/selection/active-line.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/brace-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/comment-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <style>
        :root {
            --primary: #5D5CDE;
            --primary-dark: #4847B8;
            --primary-light: #7B7AE6;
            --secondary: #FF6B6B;
            --secondary-dark: #E05555;
            --accent: #FFD166;
            --success: #06D6A0;
            --success-dark: #05B386;
            --error: #EF4444;
            --bg-light: #FFFFFF;
            --bg-dark: #111827;
            --panel-light: #F9FAFB;
            --panel-dark: #1F2937;
            --text-light: #374151;
            --text-dark: #F9FAFB;
            --border-light: #E5E7EB;
            --border-dark: #374151;
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-dark: rgba(0, 0, 0, 0.5);
            
            /* Theme variables */
            --editor-selected-line-light: rgba(93, 92, 222, 0.1);
            --editor-selected-line-dark: rgba(93, 92, 222, 0.3);
            --editor-matchingbracket-light: rgba(255, 209, 102, 0.5);
            --editor-matchingbracket-dark: rgba(255, 209, 102, 0.7);
            --editor-selection-bg-light: rgba(93, 92, 222, 0.2);
            --editor-selection-bg-dark: rgba(93, 92, 222, 0.4);
            --editor-search-highlight-bg: rgba(255, 215, 0, 0.3);
            --editor-search-highlight-bg-dark: rgba(255, 215, 0, 0.5);
        }

        .dark {
            --bg-color: var(--bg-dark);
            --text-color: var(--text-dark);
            --panel-bg: var(--panel-dark);
            --panel-border: var(--border-dark);
            --shadow: var(--shadow-dark);
            --editor-selected-line: var(--editor-selected-line-dark);
            --editor-matchingbracket: var(--editor-matchingbracket-dark);
            --editor-selection-bg: var(--editor-selection-bg-dark);
            --editor-search-highlight: var(--editor-search-highlight-bg-dark);
        }

        html:not(.dark) {
            --bg-color: var(--bg-light);
            --text-color: var(--text-light);
            --panel-bg: var(--panel-light);
            --panel-border: var(--border-light);
            --shadow: var(--shadow-light);
            --editor-selected-line: var(--editor-selected-line-light);
            --editor-matchingbracket: var(--editor-matchingbracket-light);
            --editor-selection-bg: var(--editor-selection-bg-light);
            --editor-search-highlight: var(--editor-search-highlight-bg);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            overflow-x: hidden;
        }

        /* Cursor animation */
        @media (pointer: fine) {
            * {
                /*cursor: none;*/
            }

            #custom-cursor {
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background: linear-gradient(45deg, var(--primary), var(--secondary));
                position: fixed;
                top: 0;
                left: 0;
                pointer-events: none;
                z-index: 9999;
                transform: translate(-50%, -50%);
                transition: width 0.2s, height 0.2s, background 0.2s;
                mix-blend-mode: difference;
                filter: drop-shadow(0 0 5px rgba(93, 92, 222, 0.5));
            }

            #cursor-trail {
                position: fixed;
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background-color: rgba(93, 92, 222, 0.5);
                pointer-events: none;
                z-index: 9998;
                transform: translate(-50%, -50%);
                transition: opacity 0.5s;
                opacity: 0;
            }

            .clickable:hover ~ #custom-cursor {
                width: 40px;
                height: 40px;
                background: linear-gradient(45deg, var(--accent), var(--success));
            }
        }

        /* Animated background blobs */
        @keyframes blob {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(20px, -20px) scale(1.1); }
            50% { transform: translate(0, 20px) scale(1); }
            75% { transform: translate(-20px, -20px) scale(0.9); }
        }

        .animate-blob {
            animation: blob 15s infinite;
        }

        .animation-delay-2000 {
            animation-delay: 4s;
        }

        .animation-delay-4000 {
            animation-delay: 8s;
        }

        /* Floating animation */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .animate-float {
            animation: float 5s ease-in-out infinite;
        }

        /* Card hover effect */
        .card-3d {
            transition: all 0.3s ease-out;
            transform-style: preserve-3d;
            perspective: 800px;
        }

        .card-3d:hover {
            transform: translateY(-10px) rotateX(5deg);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }

        .dark .card-3d:hover {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .glassmorphism-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dark .glassmorphism-container {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        .code-tab {
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .code-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: width 0.3s;
        }

        .code-tab.active::after {
            width: 100%;
        }

        .code-editor-container {
            position: relative;
            height: 480px;
            border-radius: 0.5rem;
            overflow: auto;/*visible;*/
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px -15px rgba(0, 0, 0, 0.2);
        }

        .dark .code-editor-container {
            box-shadow: 0 10px 30px -15px rgba(0, 0, 0, 0.5);
        }

        .code-editor-container:hover {
            box-shadow: 0 15px 40px -15px rgba(93, 92, 222, 0.4);
            transform: translateY(-5px);
        }

        .dark .code-editor-container:hover {
            box-shadow: 0 15px 40px -15px rgba(93, 92, 222, 0.2);
        }

        /* CodeMirror */
        .CodeMirror {
            height: 100%;
            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 15px;
            line-height: 1.6;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }

        .CodeMirror-gutters {
            border-right: 1px solid rgba(0,0,0,0.1);
            background-color: rgba(245, 245, 245, 0.5);
            border-top-left-radius: 0.5rem;
            border-bottom-left-radius: 0.5rem;
        }

        .dark .CodeMirror-gutters {
            border-right: 1px solid rgba(255,255,255,0.1);
            background-color: rgba(31, 41, 55, 0.5);
        }

        .dark .CodeMirror {
            background-color: #1E1E3F !important;
        }

        .CodeMirror-linenumber {
            padding: 0 8px;
            color: #6B7280;
        }

        .CodeMirror-selected {
            background-color: var(--editor-selection-bg) !important;
        }

        .CodeMirror-cursor {
            border-left: 2px solid var(--primary) !important;
        }

        .CodeMirror-activeline-background {
            background-color: var(--editor-selected-line) !important;
        }

        .CodeMirror-matchingbracket {
            background-color: var(--editor-matchingbracket) !important;
            color: inherit !important;
            border-bottom: 1px solid var(--primary);
        }

        /* Search highlight */
        .search-highlight {
            background-color: var(--editor-search-highlight);
        }

        .search-highlight-selected {
            background-color: rgba(255, 165, 0, 0.5);
            border: 1px solid orange;
        }

        /* Search input container */
        .search-container {
            position: relative;
        }

        .search-buttons {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            display: flex;
        }

        .search-button {
            height: 100%;
            padding: 0 8px;
            background-color: var(--panel-bg);
            border-left: 1px solid var(--panel-border);
            color: var(--text-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-button:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .search-button:last-child {
            border-top-right-radius: 0.25rem;
            border-bottom-right-radius: 0.25rem;
        }

        .CodeMirror .cm-keyword {
            color: #C792EA;
        }

        .CodeMirror .cm-def {
            color: #82AAFF;
        }

        .CodeMirror .cm-variable {
            color: #f07178;
        }

        .CodeMirror .cm-string {
            color: #C3E88D;
        }

        .CodeMirror .cm-comment {
            color: #676E95;
            font-style: italic;
        }

        .CodeMirror .cm-number {
            color: #FF9E64;
        }

        .CodeMirror .cm-property {
            color: #A9B7C6;
        }

        .CodeMirror .cm-operator {
            color: #89DDFF;
        }

        .CodeMirror .cm-tag {
            color: #FF5370;
        }

        .CodeMirror .cm-attribute {
            color: #FFCB6B;
        }

        /* CodeMirror Foldgutter */
        .CodeMirror-foldgutter {
            width: 1.4em;
        }

        .CodeMirror-foldgutter-open,
        .CodeMirror-foldgutter-folded {
            cursor: pointer;
            color: #6B7280;
        }

        .CodeMirror-foldgutter-open:after {
            content: "▾";
        }

        .CodeMirror-foldgutter-folded:after {
            content: "▸";
        }

        /* Fixed preview container */
        .preview-container {
            background-color: white;
            color: black;
            border-radius: 0.5rem;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: all 0.5s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .preview-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        #preview-section {
            height: 100%;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #preview-wrapper {
            flex: 1;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            padding: 10px;
            border-radius: 1rem;
        }

        #output-display {
            width: 100%;
            height: 100%;
            overflow: auto;
            padding: 1rem;
            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 15px;
            line-height: 1.6;
            scrollbar-width: thin;
        }

        /* Make iframe full sized within the preview container */
        #preview-frame {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        #preview-frame:hover {
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .bouncy {
            animation: bounce 0.6s;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-15px);
            }
            60% {
                transform: translateY(-7px);
            }
        }

        .tool-button {
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .tool-button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .tool-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .dark .tool-button:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .tool-button:hover::after {
            animation: ripple 0.6s linear;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 1;
            }
            20% {
                transform: scale(25, 25);
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: scale(40, 40);
            }
        }

        .file-tab {
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            border-bottom: 2px solid transparent;
        }

        .file-tab:hover {
            background-color: rgba(93, 92, 222, 0.05);
        }

        .file-tab.active {
            border-bottom-color: var(--primary);
            background-color: rgba(93, 92, 222, 0.1);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--panel-bg);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(93, 92, 222, 0.6);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        .drop-zone {
            border: 2px dashed var(--panel-border);
            transition: all 0.2s;
        }

        .drop-zone:hover {
            border-color: var(--primary);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        .device-frame {
            border: 8px solid #333;
            border-radius: 24px;
            transition: all 0.3s;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .device-frame:hover {
            transform: rotateX(5deg) rotateY(5deg);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.2);
        }

        .device-frame.mobile {
            width: 375px;
            height: 667px;
        }

        .device-frame.tablet {
            width: 768px;
            height: 1024px;
        }

        .error-line {
            background-color: rgba(239, 68, 68, 0.2);
            position: absolute;
            left: 0;
            right: 0;
        }

        .hint-marker {
            position: absolute;
            right: 0.5rem;
            color: var(--error);
            cursor: pointer;
        }

        .console-output {
            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            overflow-y: auto;
            height: 180px;
            padding: 0.5rem;
            border-radius: 0.5rem;
            background-color: #1E1E3F; /* Dark background for console */
            color: #EDEDED; /* Light text */
            position: relative;
        }

        .console-output::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(30, 30, 63, 0.9), rgba(30, 30, 63, 0.2));
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .console-output:hover::before {
            opacity: 0.1;
        }

        .console-log {
            padding: 6px 10px;
            border-radius: 4px;
            margin-bottom: 4px;
            border-left: 3px solid transparent;
            background-color: rgba(255, 255, 255, 0.05);
            word-break: break-word;
        }

        .console-error {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--error);
            border-left-color: var(--error);
        }

        .console-warn {
            background-color: rgba(245, 158, 11, 0.1);
            color: #F59E0B;
            border-left-color: #F59E0B;
        }

        .console-info {
            background-color: rgba(59, 130, 246, 0.1);
            color: #3B82F6;
            border-left-color: #3B82F6;
        }

        .keyboard-shortcut {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 2px 6px;
            background-color: #F3F4F6;
            color: #374151;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 4px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .dark .keyboard-shortcut {
            background-color: #374151;
            color: #F3F4F6;
        }

        .tooltip {
            position: absolute;
            background-color: var(--panel-bg);
            color: var(--text-color);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 2px 10px var(--shadow);
            pointer-events: none;
        }

        .show-tooltip {
            opacity: 1;
        }

        /* Ad styles - optimized for AdSense */
        .ad-container {
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            background-color: var(--panel-bg);
            border: 1px solid var(--panel-border);
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ad-container:hover {
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transform: translateY(-5px);
        }

        .ad-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: #6B7280;
            margin-bottom: 0.5rem;
            position: absolute;
            top: 0;
            left: 0.5rem;
        }

        /* Social share buttons */
        .social-share-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .social-share-button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .social-share-button:hover {
            transform: translateY(-2px) scale(1.1);
        }

        .social-share-button:hover::after {
            animation: ripple 0.6s linear;
        }

        /* Template card styles */
        .template-card {
            border-radius: 0.5rem;
            overflow: hidden;
            transition: all 0.2s;
            box-shadow: 0 2px 10px var(--shadow-light);
            transform-style: preserve-3d;
            backface-visibility: hidden;
        }

        .template-card:hover {
            transform: translateY(-5px) rotateX(5deg);
            box-shadow: 0 15px 35px var(--shadow-light);
        }

        .dark .template-card {
            box-shadow: 0 2px 10px var(--shadow-dark);
        }

        .dark .template-card:hover {
            box-shadow: 0 15px 35px var(--shadow-dark);
        }

        /* Switch styles for AI provider selection */
        .ai-provider-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .ai-provider-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Animations for features section */
        .feature-icon {
            transition: all 0.5s ease;
        }

        .feature-card:hover .feature-icon {
            transform: scale(1.2) rotate(10deg);
        }

        /* 3D tilting effect for cards */
        .tilt-card {
            transition: transform 0.5s ease;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            z-index: 9999;
            transform: translateY(100px);
            transition: transform 0.3s ease;
            color: #333;
            backdrop-filter: blur(10px);
            border-left: 4px solid var(--primary);
            margin-top: 10px;
        }

        .toast.show {
            transform: translateY(0);
        }

        .dark .toast {
            background: rgba(30, 30, 30, 0.9);
            color: #fff;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        /* Neon effect */
        .neon-effect {
            box-shadow: 0 0 5px var(--primary),
                        0 0 10px var(--primary);
            animation: neon-pulse 2s infinite alternate;
        }

        @keyframes neon-pulse {
            from { box-shadow: 0 0 5px var(--primary), 0 0 10px var(--primary); }
            to { box-shadow: 0 0 10px var(--primary), 0 0 20px var(--primary); }
        }

        /* 3D button effect */
        .btn-3d {
            transform: translateZ(0);
            box-shadow: 0 4px 0 var(--primary-dark);
            position: relative;
            transition: all 0.2s;
        }

        .btn-3d:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 var(--primary-dark);
        }

        .btn-3d:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 var(--primary-dark);
        }

        /* Modal animations */
        .modal-content {
            transition: all 0.3s;
        }

        .modal-enter {
            opacity: 0;
            transform: scale(0.9);
        }

        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
        }

        /* Code highlighting */
        .syntax-highlighted {
            border-radius: 0.5rem;
            overflow: auto;
            max-height: 480px;
            background-color: #1E1E3F;
            color: #fff;
        }

        .syntax-highlighted pre {
            margin: 0;
            padding: 1rem;
            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 15px;
            line-height: 1.6;
        }

        /* Code lines styles */
        .code-line {
            position: relative;
            display: block;
            line-height: 1.6;
        }

        .line-number-wrapper {
            position: absolute;
            left: 0;
            width: 3rem;
            text-align: right;
            color: #6B7280;
            user-select: none;
        }

        .line-number {
            padding-right: 1rem;
        }

        .line-content {
            padding-left: 3.5rem;
        }

        /* Glow effect */
        .glow-on-hover {
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .glow-on-hover:before {
            content: '';
            position: absolute;
            z-index: -1;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(93, 92, 222, 0.3) 0%, rgba(93, 92, 222, 0) 70%);
            transform: rotate(0deg);
            opacity: 0;
            transition: opacity 0.5s, transform 2s;
        }

        .glow-on-hover:hover:before {
            opacity: 1;
            transform: rotate(180deg);
        }
        
        /* Enhanced search styling */
        .search-container {
            position: relative;
            display: inline-flex;
            align-items: center;
        }
        
        .search-highlight-count {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7rem;
            color: var(--text-color);
            background-color: var(--primary-light);
            color: white;
            border-radius: 1rem;
            padding: 0.1rem 0.4rem;
            pointer-events: none;
        }
        
        /* Code theme selector */
        .theme-selector {
            width: 100%;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }
        
        .theme-option {
            border: 2px solid transparent;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .theme-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .theme-option.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px var(--primary-light);
        }
        
        .theme-preview {
            height: 60px;
            padding: 5px;
            font-family: monospace;
            font-size: 10px;
        }
        
        .theme-name {
            text-align: center;
            padding: 5px;
            font-size: 12px;
            background-color: var(--panel-bg);
        }
        
        /* Line highlight style */
        .CodeMirror-activeline-background {
            background-color: var(--editor-selected-line);
        }
        
        /* Preview controls enhancement */
        .preview-controls {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border-top: 1px solid var(--panel-border);
            background-color: var(--panel-bg);
        }
        
        .preview-device-button {
            margin-right: 0.5rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            background-color: var(--panel-bg);
            border: 1px solid var(--panel-border);
            color: var(--text-color);
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s;
        }
        
        .preview-device-button:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }
        
        .preview-device-button.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary-dark);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Custom cursor -->
    <div id="custom-cursor"></div>
    <div id="cursor-trail"></div>

    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <header class="mb-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <div class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 animate-pulse-slow clickable glow-on-hover">
                        CodeCraft <span class="text-lg font-normal">Pro</span>
                    </div>
                    <div class="bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200 py-1 px-3 rounded-full text-xs font-medium animate-float">v2.0</div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="hidden md:flex space-x-2">
                        <button id="auto-refresh-toggle" class="tool-button clickable flex items-center text-sm px-3 py-1.5 bg-gray-100 dark:bg-gray-800 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300">
                            <i class="fas fa-sync-alt mr-2 text-indigo-500"></i>
                            <span>Auto-refresh: Off</span>
                        </button>
                    </div>
                    <button id="theme-toggle" class="tool-button clickable p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 focus:outline-none hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                        <i class="fas fa-moon dark:hidden"></i>
                        <i class="fas fa-sun hidden dark:block"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Top Ad Container -->
        <div class="ad-container mb-6 relative">
            <div class="ad-label">Advertisement</div>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-1158797123946133"
                 data-ad-slot="1234567890"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        <!-- Main Content -->
        <main class="mb-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Editor Section -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden fade-in card-3d" style="animation-delay: 0.1s">
                    <div class="border-b border-gray-200 dark:border-gray-700">
                        <div class="flex items-center p-3">
                            <div class="flex space-x-2 mr-4">
                                <div class="w-3 h-3 rounded-full bg-red-500"></div>
                                <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                                <div class="w-3 h-3 rounded-full bg-green-500"></div>
                            </div>
                            <div class="flex overflow-x-auto hide-scrollbar" id="file-tabs-container">
                                <div class="file-tab active clickable flex items-center px-4 py-2 text-sm cursor-pointer" data-filename="index.html" data-language="html">
                                    <i class="fab fa-html5 mr-2 text-orange-500"></i>
                                    <span>index.html</span>
                                    <button class="ml-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 clickable">
                                        <i class="fas fa-times text-xs"></i>
                                    </button>
                                </div>
                                <button id="add-file-btn" class="px-4 py-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 clickable">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="flex justify-between mb-3">
                            <div class="flex space-x-2">
                                <select id="language-selector" class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded py-1 px-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 clickable">
                                    <option value="html">HTML</option>
                                    <option value="css">CSS</option>
                                    <option value="javascript">JavaScript</option>
                                    <option value="typescript">TypeScript</option>
                                    <option value="python">Python</option>
                                    <option value="json">JSON</option>
                                    <option value="xml">XML</option>
                                </select>
                                <div class="relative hidden md:inline-block">
                                    <button id="indent-btn" class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded py-1 px-2 text-sm focus:outline-none hover:bg-gray-200 dark:hover:bg-gray-600 tool-button clickable">
                                        <i class="fas fa-indent mr-1"></i> Format
                                    </button>
                                    <div class="tooltip" id="indent-tooltip">Format Code (Shift+Alt+F)</div>
                                </div>
                                <div class="relative hidden md:inline-block">
                                    <button id="theme-code-btn" class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded py-1 px-2 text-sm focus:outline-none hover:bg-gray-200 dark:hover:bg-gray-600 tool-button clickable">
                                        <i class="fas fa-palette mr-1"></i> Theme
                                    </button>
                                    <div class="tooltip" id="theme-tooltip">Change editor theme</div>
                                </div>
                            </div>
                            <div class="search-container relative">
                                <input type="text" id="search-input" class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded py-1 px-2 pr-16 text-sm focus:outline-none" placeholder="Search..." aria-label="Search in code">
                                <div id="search-highlight-count" class="search-highlight-count hidden"></div>
                            </div>
                            <div class="flex space-x-2">
                                <button id="copy-btn" class="tool-button clickable bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded py-1 px-3 text-sm flex items-center">
                                    <i class="fas fa-copy mr-1"></i> Copy
                                </button>
                                <button id="clear-btn" class="tool-button clickable bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded py-1 px-3 text-sm flex items-center">
                                    <i class="fas fa-trash-alt mr-1"></i> Clear
                                </button>
                            </div>
                        </div>
                        <div class="code-editor-container bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg">
                            <div id="code-mirror-editor"></div>
                        </div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-900 p-4 border-t border-gray-200 dark:border-gray-700">
                        <div class="flex justify-between">
                            <div>
                                <span id="char-count" class="text-xs text-gray-500 dark:text-gray-400">0 characters</span>
                                <span class="mx-2 text-gray-300 dark:text-gray-600">|</span>
                                <span id="line-count" class="text-xs text-gray-500 dark:text-gray-400">1 lines</span>
                                <span class="mx-2 text-gray-300 dark:text-gray-600">|</span>
                                <span id="selection-info" class="text-xs text-gray-500 dark:text-gray-400 hidden md:inline">No selection</span>
                            </div>
                            <button id="run-btn" class="tool-button clickable btn-3d bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-medium py-2 px-4 rounded-lg flex items-center">
                                <i class="fas fa-play mr-2"></i> Run Code
                                <span class="keyboard-shortcut hidden md:inline-block">⌘+Enter</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Preview Section -->
                <div class="flex flex-col h-full bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden fade-in card-3d" style="animation-delay: 0.2s">
                    <!-- Tabs for Preview/Console -->
                    <div class="border-b border-gray-200 dark:border-gray-700">
                        <div class="flex items-center px-4 py-3">
                            <div class="flex space-x-1">
                                <button class="code-tab clickable active px-4 py-2 text-sm font-medium" data-target="preview-section">
                                    <i class="fas fa-eye mr-2 text-indigo-500"></i> Preview
                                </button>
                                <button class="code-tab clickable px-4 py-2 text-sm font-medium" data-target="console-section">
                                    <i class="fas fa-terminal mr-2 text-green-500"></i> Console
                                </button>
                                <button class="code-tab clickable px-4 py-2 text-sm font-medium" data-target="source-section">
                                    <i class="fas fa-code mr-2 text-blue-500"></i> Source
                                </button>
                            </div>
                            <div id="preview-loading" class="ml-2 hidden">
                                <i class="fas fa-circle-notch fa-spin text-indigo-500"></i>
                            </div>
                            <div class="ml-auto flex space-x-2">
                                <div class="relative hidden sm:block">
                                    <select id="device-selector" class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded py-1 px-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 clickable">
                                        <option value="responsive">Responsive</option>
                                        <option value="mobile">Mobile</option>
                                        <option value="tablet">Tablet</option>
                                        <option value="desktop">Desktop</option>
                                    </select>
                                </div>
                                <button id="refresh-btn" class="tool-button clickable bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded py-1 px-3 text-sm flex items-center">
                                    <i class="fas fa-sync-alt mr-1"></i> Refresh
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Preview Area with Improved Scrolling -->
                    <div class="flex-grow overflow-hidden">
                        <!-- Preview Section -->
                        <div id="preview-section" class="h-full">
                            <div id="preview-wrapper" class="relative glassmorphism-container">
                                <div class="absolute -z-10 top-20 -left-10 w-40 h-40 bg-purple-400 rounded-full filter blur-3xl opacity-20 animate-blob"></div>
                                <div class="absolute -z-10 top-10 -right-10 w-40 h-40 bg-yellow-400 rounded-full filter blur-3xl opacity-20 animate-blob animation-delay-2000"></div>
                                <div class="absolute -z-10 bottom-10 left-20 w-40 h-40 bg-pink-400 rounded-full filter blur-3xl opacity-20 animate-blob animation-delay-4000"></div>
                                <div id="preview-container" class="preview-container shadow-lg transition-all duration-500 transform hover:scale-[1.02]">
                                    <div id="output-display" class="w-full h-full flex justify-center items-center text-gray-400">
                                        <div class="text-center transform transition-all duration-500 hover:scale-105">
                                            <i class="fas fa-code text-5xl mb-4 text-indigo-200 dark:text-indigo-800 animate-float"></i>
                                            <p class="text-lg">Enter some code and click "Run" to see the preview</p>
                                            <div class="mt-4 w-32 h-1 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full mx-auto"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Console Section -->
                        <div id="console-section" class="h-full p-4 hidden">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium">Console Output</h3>
                                <button id="clear-console-btn" class="clickable text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-all duration-300 hover:scale-110">
                                    <i class="fas fa-trash-alt mr-1"></i> Clear Console
                                </button>
                            </div>
                            <div id="console-output" class="console-output shadow-inner">
                                <div class="console-log console-info">Console ready. Run your code to see output.</div>
                            </div>
                        </div>
                        
                        <!-- Source View Section -->
                        <div id="source-section" class="h-full p-4 hidden">
                            <div id="code-output" class="syntax-highlighted h-full rounded-lg shadow-inner">
                                <pre><code class="language-html"></code></pre>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Preview Footer -->
                    <div class="bg-gray-50 dark:bg-gray-900 p-4 border-t border-gray-200 dark:border-gray-700">
                        <div class="flex justify-between items-center">
                            <div class="text-xs text-gray-500 dark:text-gray-400">
                                <span id="preview-info"><i class="fas fa-info-circle mr-1"></i> Preview updates when you run the code</span>
                            </div>
                            <div class="flex space-x-2">
                                <button id="save-btn" class="tool-button clickable bg-indigo-100 hover:bg-indigo-200 dark:bg-indigo-900 dark:hover:bg-indigo-800 text-indigo-800 dark:text-indigo-200 rounded py-1 px-3 text-sm flex items-center">
                                    <i class="fas fa-save mr-1"></i> Save
                                </button>
                                <button id="new-window-btn" class="tool-button clickable bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded py-1 px-3 text-sm flex items-center">
                                    <i class="fas fa-external-link-alt mr-1"></i> New Tab
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Middle Ad Container -->
            <div class="ad-container my-6 relative">
                <div class="ad-label">Advertisement</div>
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-1158797123946133"
                     data-ad-slot="2345678901"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
            
            <!-- Social Sharing Section -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 my-6 fade-in card-3d glassmorphism-container transform transition-all duration-500 hover:scale-[1.02]" style="animation-delay: 0.35s">
                <h3 class="text-lg font-medium mb-4">
                    <i class="fas fa-share-alt text-indigo-500 mr-2 animate-float"></i> Share Your Code
                </h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                    Share your creation with friends and colleagues or on social media.
                </p>
                <div class="flex flex-wrap gap-3">
                    <button id="share-twitter" class="social-share-button clickable bg-blue-50 hover:bg-blue-100 dark:bg-blue-900 dark:hover:bg-blue-800 text-blue-600 dark:text-blue-300">
                        <i class="fab fa-twitter text-lg"></i>
                    </button>
                    <button id="share-facebook" class="social-share-button clickable bg-indigo-50 hover:bg-indigo-100 dark:bg-indigo-900 dark:hover:bg-indigo-800 text-indigo-600 dark:text-indigo-300">
                        <i class="fab fa-facebook text-lg"></i>
                    </button>
                    <button id="share-linkedin" class="social-share-button clickable bg-blue-50 hover:bg-blue-100 dark:bg-blue-900 dark:hover:bg-blue-800 text-blue-600 dark:text-blue-300">
                        <i class="fab fa-linkedin text-lg"></i>
                    </button>
                    <button id="share-whatsapp" class="social-share-button clickable bg-green-50 hover:bg-green-100 dark:bg-green-900 dark:hover:bg-green-800 text-green-600 dark:text-green-300">
                        <i class="fab fa-whatsapp text-lg"></i>
                    </button>
                    <button id="share-email" class="social-share-button clickable bg-gray-50 hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-600 dark:text-gray-300">
                        <i class="fas fa-envelope text-lg"></i>
                    </button>
                    <button id="create-link" class="clickable ml-auto btn-3d bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-md text-sm flex items-center">
                        <i class="fas fa-link mr-2"></i>
                        Generate Shareable Link
                    </button>
                </div>
                <div id="share-link-container" class="mt-4 hidden">
                    <div class="flex">
                        <input type="text" id="share-link" readonly class="flex-grow p-2 border border-gray-300 dark:border-gray-600 rounded-l-md text-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                        <button id="copy-link-btn" class="clickable bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-r-md text-sm tool-button">
                            <i class="fas fa-copy mr-1"></i> Copy
                        </button>
                    </div>
                </div>
            </div>

            <!-- Empty Templates Section (as requested) -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 my-6 fade-in card-3d glassmorphism-container transform transition-all duration-500 hover:scale-[1.02]" style="animation-delay: 0.4s">
                <h3 class="text-lg font-medium mb-4">
                    <i class="fas fa-star text-yellow-500 mr-2 animate-float"></i> Popular Templates
                </h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                    Get started quickly with these popular templates.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Empty template cards as requested - will be manually filled -->
                </div>
            </div>
            
            <!-- Console Panel (Collapsible) -->
            <div class="mt-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden fade-in card-3d" style="animation-delay: 0.3s">
                <div class="border-b border-gray-200 dark:border-gray-700 p-3 cursor-pointer clickable" id="tools-header">
                    <div class="flex justify-between items-center">
                        <div class="font-medium flex items-center">
                            <i class="fas fa-tools mr-2 text-indigo-500 animate-float"></i>
                            <span>Developer Tools</span>
                        </div>
                        <i class="fas fa-chevron-down text-gray-400 transition-transform duration-300" id="tools-chevron"></i>
                    </div>
                </div>
                <div class="overflow-hidden transition-all duration-300 max-h-0" id="tools-content">
                    <div class="p-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- HTML Validator -->
                        <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-3 border border-gray-200 dark:border-gray-700 transform transition-all duration-500 hover:scale-105 card-3d">
                            <h3 class="text-sm font-medium mb-2 flex items-center">
                                <i class="fas fa-check-circle mr-2 text-green-500"></i> HTML Validator
                            </h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-3">Check your HTML code for errors and warnings.</p>
                            <button id="validate-html-btn" class="clickable w-full bg-green-100 hover:bg-green-200 dark:bg-green-900 dark:hover:bg-green-800 text-green-800 dark:text-green-200 text-sm font-medium py-1.5 px-3 rounded flex items-center justify-center tool-button">
                                <i class="fas fa-spell-check mr-2"></i> Validate HTML
                            </button>
                        </div>
                        
                        <!-- CSS Beautifier -->
                        <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-3 border border-gray-200 dark:border-gray-700 transform transition-all duration-500 hover:scale-105 card-3d">
                            <h3 class="text-sm font-medium mb-2 flex items-center">
                                <i class="fas fa-paint-brush mr-2 text-purple-500"></i> CSS Beautifier
                            </h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-3">Format and beautify your CSS code.</p>
                            <button id="beautify-css-btn" class="clickable w-full bg-purple-100 hover:bg-purple-200 dark:bg-purple-900 dark:hover:bg-purple-800 text-purple-800 dark:text-purple-200 text-sm font-medium py-1.5 px-3 rounded flex items-center justify-center tool-button">
                                <i class="fas fa-magic mr-2"></i> Beautify CSS
                            </button>
                        </div>
                        
                        <!-- JS Formatter -->
                        <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-3 border border-gray-200 dark:border-gray-700 transform transition-all duration-500 hover:scale-105 card-3d">
                            <h3 class="text-sm font-medium mb-2 flex items-center">
                                <i class="fab fa-js-square mr-2 text-yellow-500"></i> JS Formatter
                            </h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-3">Format and lint your JavaScript code.</p>
                            <button id="format-js-btn" class="clickable w-full bg-yellow-100 hover:bg-yellow-200 dark:bg-yellow-900 dark:hover:bg-yellow-800 text-yellow-800 dark:text-yellow-200 text-sm font-medium py-1.5 px-3 rounded flex items-center justify-center tool-button">
                                <i class="fas fa-code mr-2"></i> Format JavaScript
                            </button>
                        </div>
                    </div>
                    <div class="p-4 pt-0 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Responsive Tester -->
                        <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-3 border border-gray-200 dark:border-gray-700 transform transition-all duration-500 hover:scale-105 card-3d">
                            <h3 class="text-sm font-medium mb-2 flex items-center">
                                <i class="fas fa-mobile-alt mr-2 text-blue-500"></i> Responsive Tester
                            </h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-3">Test your design on different screen sizes.</p>
                            <div class="flex space-x-2">
                                <button data-device="mobile" class="device-btn clickable flex-1 bg-blue-100 hover:bg-blue-200 dark:bg-blue-900 dark:hover:bg-blue-800 text-blue-800 dark:text-blue-200 text-xs font-medium py-1.5 px-2 rounded tool-button">
                                    <i class="fas fa-mobile-alt mr-1"></i> Mobile
                                </button>
                                <button data-device="tablet" class="device-btn clickable flex-1 bg-blue-100 hover:bg-blue-200 dark:bg-blue-900 dark:hover:bg-blue-800 text-blue-800 dark:text-blue-200 text-xs font-medium py-1.5 px-2 rounded tool-button">
                                    <i class="fas fa-tablet-alt mr-1"></i> Tablet
                                </button>
                                <button data-device="desktop" class="device-btn clickable flex-1 bg-blue-100 hover:bg-blue-200 dark:bg-blue-900 dark:hover:bg-blue-800 text-blue-800 dark:text-blue-200 text-xs font-medium py-1.5 px-2 rounded tool-button">
                                    <i class="fas fa-desktop mr-1"></i> Desktop
                                </button>
                            </div>
                        </div>
                        
                        <!-- Minifier -->
                        <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-3 border border-gray-200 dark:border-gray-700 transform transition-all duration-500 hover:scale-105 card-3d">
                            <h3 class="text-sm font-medium mb-2 flex items-center">
                                <i class="fas fa-compress-arrows-alt mr-2 text-red-500"></i> Code Minifier
                            </h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-3">Minify your code to reduce file size.</p>
                            <button id="minify-code-btn" class="clickable w-full bg-red-100 hover:bg-red-200 dark:bg-red-900 dark:hover:bg-red-800 text-red-800 dark:text-red-200 text-sm font-medium py-1.5 px-3 rounded flex items-center justify-center tool-button">
                                <i class="fas fa-compress mr-2"></i> Minify Code
                            </button>
                        </div>
                        
                        <!-- AI Code Helper -->
                        <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-3 border border-gray-200 dark:border-gray-700 transform transition-all duration-500 hover:scale-105 card-3d">
                            <h3 class="text-sm font-medium mb-2 flex items-center">
                                <i class="fas fa-robot mr-2 text-indigo-500"></i> AI Code Helper
                            </h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-3">Get AI assistance with your code.</p>
                            <button id="ai-helper-btn" class="clickable w-full bg-indigo-100 hover:bg-indigo-200 dark:bg-indigo-900 dark:hover:bg-indigo-800 text-indigo-800 dark:text-indigo-200 text-sm font-medium py-1.5 px-3 rounded flex items-center justify-center neon-effect">
                                <i class="fas fa-magic mr-2"></i> Get AI Help
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Ad Container -->
        <div class="ad-container mb-6 relative">
            <div class="ad-label">Advertisement</div>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-1158797123946133"
                 data-ad-slot="3456789012"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        <!-- Features Section -->
        <section class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow fade-in tilt-card transform transition-all duration-500 hover:scale-105 glow-on-hover" style="animation-delay: 0.4s">
                <div class="text-indigo-500 mb-4 feature-icon">
                    <i class="fas fa-bolt text-3xl"></i>
                </div>
                <h3 class="text-xl font-semibold mb-2">Live Preview</h3>
                <p class="text-gray-600 dark:text-gray-300 text-sm">See your code changes instantly with our responsive preview panel.</p>
            </div>
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow fade-in tilt-card transform transition-all duration-500 hover:scale-105 glow-on-hover" style="animation-delay: 0.5s">
                <div class="text-pink-500 mb-4 feature-icon">
                    <i class="fas fa-code text-3xl"></i>
                </div>
                <h3 class="text-xl font-semibold mb-2">Pro Editor</h3>
                <p class="text-gray-600 dark:text-gray-300 text-sm">Syntax highlighting, line numbers, and code formatting for efficient coding.</p>
            </div>
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow fade-in tilt-card transform transition-all duration-500 hover:scale-105 glow-on-hover" style="animation-delay: 0.6s">
                <div class="text-yellow-500 mb-4 feature-icon">
                    <i class="fas fa-terminal text-3xl"></i>
                </div>
                <h3 class="text-xl font-semibold mb-2">Console Output</h3>
                <p class="text-gray-600 dark:text-gray-300 text-sm">Debug your code with an integrated console that captures logs and errors.</p>
            </div>
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow fade-in tilt-card transform transition-all duration-500 hover:scale-105 glow-on-hover" style="animation-delay: 0.7s">
                <div class="text-green-500 mb-4 feature-icon">
                    <i class="fas fa-tools text-3xl"></i>
                </div>
                <h3 class="text-xl font-semibold mb-2">Dev Tools</h3>
                <p class="text-gray-600 dark:text-gray-300 text-sm">Validation, formatting, and responsive testing all in one place.</p>
            </div>
        </section>

        <!-- Keyboard Shortcuts Modal -->
        <div id="shortcuts-modal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full p-6 transform transition-all duration-300 scale-95 opacity-0 modal-content" id="shortcuts-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium">Keyboard Shortcuts</h3>
                    <button id="close-shortcuts-btn" class="clickable text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="text-sm font-medium text-indigo-600 dark:text-indigo-400 mb-2">Editor</h4>
                        <ul class="space-y-2 text-sm">
                            <li class="flex justify-between">
                                <span>Run Code</span>
                                <span class="keyboard-shortcut">⌘+Enter</span>
                            </li>
                            <li class="flex justify-between">
                                <span>Format Code</span>
                                <span class="keyboard-shortcut">Shift+Alt+F</span>
                            </li>
                            <li class="flex justify-between">
                                <span>Save</span>
                                <span class="keyboard-shortcut">⌘+S</span>
                            </li>
                            <li class="flex justify-between">
                                <span>Find</span>
                                <span class="keyboard-shortcut">⌘+F</span>
                            </li>
                            <li class="flex justify-between">
                                <span>Comment Toggle</span>
                                <span class="keyboard-shortcut">⌘+/</span>
                            </li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-indigo-600 dark:text-indigo-400 mb-2">Navigation</h4>
                        <ul class="space-y-2 text-sm">
                            <li class="flex justify-between">
                                <span>Switch to Preview</span>
                                <span class="keyboard-shortcut">Alt+1</span>
                            </li>
                            <li class="flex justify-between">
                                <span>Switch to Console</span>
                                <span class="keyboard-shortcut">Alt+2</span>
                            </li>
                            <li class="flex justify-between">
                                <span>Switch to Source</span>
                                <span class="keyboard-shortcut">Alt+3</span>
                            </li>
                            <li class="flex justify-between">
                                <span>Next File</span>
                                <span class="keyboard-shortcut">⌘+Tab</span>
                            </li>
                            <li class="flex justify-between">
                                <span>Toggle Developer Tools</span>
                                <span class="keyboard-shortcut">⌘+Shift+D</span>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="mt-4 text-center">
                    <button id="dismiss-shortcuts-btn" class="clickable px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md text-sm font-medium btn-3d">
                        Got it
                    </button>
                </div>
            </div>
        </div>

        <!-- Add File Modal -->
        <div id="add-file-modal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6 transform transition-all duration-300 scale-95 opacity-0 modal-content" id="add-file-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium">Add New File</h3>
                    <button id="close-modal-btn" class="clickable text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mb-4">
                    <label for="filename-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Filename</label>
                    <input type="text" id="filename-input" placeholder="e.g. style.css" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div class="mb-4">
                    <label for="filetype-select" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">File Type</label>
                    <select id="filetype-select" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="html">HTML</option>
                        <option value="css">CSS</option>
                        <option value="js">JavaScript</option>
                        <option value="ts">TypeScript</option>
                        <option value="py">Python</option>
                        <option value="json">JSON</option>
                        <option value="xml">XML</option>
                    </select>
                </div>
                <div class="flex justify-end">
                    <button id="cancel-file-btn" class="clickable mr-2 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-md tool-button">
                        Cancel
                    </button>
                    <button id="create-file-btn" class="clickable px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md btn-3d">
                        Create File
                    </button>
                </div>
            </div>
        </div>

        <!-- AI Helper Modal -->
        <div id="ai-helper-modal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full p-6 transform transition-all duration-300 scale-95 opacity-0 modal-content" id="ai-helper-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium flex items-center">
                        <i class="fas fa-robot text-indigo-500 mr-2 animate-float"></i>
                        AI Code Helper
                    </h3>
                    <button id="close-ai-modal-btn" class="clickable text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-4">
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            AI provider:
                        </p>
                        <div class="flex items-center">
                            <span class="text-sm text-gray-600 dark:text-gray-400 mr-2">MR Bot API</span>
                            <label class="ai-provider-switch hidden">
                                <input type="checkbox" id="ai-provider-toggle" disabled>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    <div id="custom-ai-container" class="mb-4">
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">
                            Using MR Bot API at <span class="font-mono text-xs bg-gray-100 dark:bg-gray-700 px-1 py-0.5 rounded">https://api.mrbot.com</span>
                        </p>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                        What would you like help with? Select an option or describe your issue below.
                    </p>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button class="ai-quick-action clickable bg-indigo-50 hover:bg-indigo-100 dark:bg-indigo-900 dark:hover:bg-indigo-800 text-indigo-800 dark:text-indigo-200 text-sm py-2 px-3 rounded-md text-left transform transition-all duration-300 hover:scale-[1.02]">
                            <i class="fas fa-bug mr-2"></i> Fix code errors
                        </button>
                        <button class="ai-quick-action clickable bg-indigo-50 hover:bg-indigo-100 dark:bg-indigo-900 dark:hover:bg-indigo-800 text-indigo-800 dark:text-indigo-200 text-sm py-2 px-3 rounded-md text-left transform transition-all duration-300 hover:scale-[1.02]">
                            <i class="fas fa-magic mr-2"></i> Optimize my code
                        </button>
                        <button class="ai-quick-action clickable bg-indigo-50 hover:bg-indigo-100 dark:bg-indigo-900 dark:hover:bg-indigo-800 text-indigo-800 dark:text-indigo-200 text-sm py-2 px-3 rounded-md text-left transform transition-all duration-300 hover:scale-[1.02]">
                            <i class="fas fa-plus mr-2"></i> Add a feature
                        </button>
                        <button class="ai-quick-action clickable bg-indigo-50 hover:bg-indigo-100 dark:bg-indigo-900 dark:hover:bg-indigo-800 text-indigo-800 dark:text-indigo-200 text-sm py-2 px-3 rounded-md text-left transform transition-all duration-300 hover:scale-[1.02]">
                            <i class="fas fa-lightbulb mr-2"></i> Explain this code
                        </button>
                    </div>
                    <textarea id="ai-prompt" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500 h-24" placeholder="Describe what you need help with..."></textarea>
                </div>
                <div class="flex justify-between items-center">
                    <div class="text-xs text-gray-500 dark:text-gray-400">
                        <i class="fas fa-info-circle mr-1"></i> <span id="ai-provider-info">Using MR Bot to analyze code</span>
                    </div>
                    <button id="send-to-ai-btn" class="clickable px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md text-sm font-medium flex items-center btn-3d">
                        <i class="fas fa-paper-plane mr-2"></i>
                        Get AI Help
                    </button>
                </div>
            </div>
        </div>

        <!-- Theme selector modal -->
        <div id="theme-modal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-3xl w-full p-6 transform transition-all duration-300 scale-95 opacity-0 modal-content" id="theme-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium flex items-center">
                        <i class="fas fa-palette text-indigo-500 mr-2"></i>
                        Editor Theme
                    </h3>
                    <button id="close-theme-modal-btn" class="clickable text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mb-4 theme-selector">
                    <div class="theme-option clickable active" data-theme="dracula">
                        <div class="theme-preview" style="background-color: #282a36; color: #f8f8f2;">
                            <span style="color: #ff79c6;">function</span> <span style="color: #50fa7b;">example</span>() {<br>
                            &nbsp;&nbsp;<span style="color: #f1fa8c;">return</span> true;<br>
                            }
                        </div>
                        <div class="theme-name">Dracula</div>
                    </div>
                    <div class="theme-option clickable" data-theme="monokai">
                        <div class="theme-preview" style="background-color: #272822; color: #f8f8f2;">
                            <span style="color: #f92672;">function</span> <span style="color: #a6e22e;">example</span>() {<br>
                            &nbsp;&nbsp;<span style="color: #f8f8f2;">return</span> <span style="color: #ae81ff;">true</span>;<br>
                            }
                        </div>
                        <div class="theme-name">Monokai</div>
                    </div>
                    <div class="theme-option clickable" data-theme="material">
                        <div class="theme-preview" style="background-color: #263238; color: #EEFFFF;">
                            <span style="color: #89DDFF;">function</span> <span style="color: #82AAFF;">example</span>() {<br>
                            &nbsp;&nbsp;<span style="color: #89DDFF;">return</span> <span style="color: #F78C6C;">true</span>;<br>
                            }
                        </div>
                        <div class="theme-name">Material</div>
                    </div>
                    <div class="theme-option clickable" data-theme="cobalt">
                        <div class="theme-preview" style="background-color: #002240; color: #FFFFFF;">
                            <span style="color: #FF9D00;">function</span> <span style="color: #FFEE80;">example</span>() {<br>
                            &nbsp;&nbsp;<span style="color: #FF9D00;">return</span> <span style="color: #FF628C;">true</span>;<br>
                            }
                        </div>
                        <div class="theme-name">Cobalt</div>
                    </div>
                    <div class="theme-option clickable" data-theme="nord">
                        <div class="theme-preview" style="background-color: #2E3440; color: #D8DEE9;">
                            <span style="color: #81A1C1;">function</span> <span style="color: #88C0D0;">example</span>() {<br>
                            &nbsp;&nbsp;<span style="color: #81A1C1;">return</span> <span style="color: #B48EAD;">true</span>;<br>
                            }
                        </div>
                        <div class="theme-name">Nord</div>
                    </div>
                    <div class="theme-option clickable" data-theme="ayu-dark">
                        <div class="theme-preview" style="background-color: #0A0E14; color: #B3B1AD;">
                            <span style="color: #FF8F40;">function</span> <span style="color: #FFB454;">example</span>() {<br>
                            &nbsp;&nbsp;<span style="color: #FF8F40;">return</span> <span style="color: #E6B450;">true</span>;<br>
                            }
                        </div>
                        <div class="theme-name">Ayu Dark</div>
                    </div>
                    <div class="theme-option clickable" data-theme="ayu-mirage">
                        <div class="theme-preview" style="background-color: #1F2430; color: #CBCCC6;">
                            <span style="color: #FFA759;">function</span> <span style="color: #FFD580;">example</span>() {<br>
                            &nbsp;&nbsp;<span style="color: #FFA759;">return</span> <span style="color: #D5FF80;">true</span>;<br>
                            }
                        </div>
                        <div class="theme-name">Ayu Mirage</div>
                    </div>
                    <div class="theme-option clickable" data-theme="solarized">
                        <div class="theme-preview" style="background-color: #002B36; color: #839496;">
                            <span style="color: #268BD2;">function</span> <span style="color: #B58900;">example</span>() {<br>
                            &nbsp;&nbsp;<span style="color: #268BD2;">return</span> <span style="color: #2AA198;">true</span>;<br>
                            }
                        </div>
                        <div class="theme-name">Solarized</div>
                    </div>
                    <div class="theme-option clickable" data-theme="default">
                        <div class="theme-preview light-preview" style="background-color: #ffffff; color: #000000;">
                            <span style="color: #770088;">function</span> <span style="color: #0000FF;">example</span>() {<br>
                            &nbsp;&nbsp;<span style="color: #770088;">return</span> <span style="color: #116644;">true</span>;<br>
                            }
                        </div>
                        <div class="theme-name">Default Light</div>
                    </div>
                </div>
                <div class="mt-4 flex justify-between items-center">
                    <div class="text-sm">
                        <label class="flex items-center">
                            <input type="checkbox" id="highlight-active-line" class="mr-2 text-indigo-600" checked>
                            <span>Highlight active line</span>
                        </label>
                    </div>
                    <button id="apply-theme-btn" class="clickable px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md text-sm font-medium btn-3d">
                        Apply Theme
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center text-gray-500 dark:text-gray-400 text-sm py-4 border-t border-gray-200 dark:border-gray-700">
            <div class="flex justify-center space-x-4 mb-2">
                <button id="shortcuts-btn" class="clickable text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-sm flex items-center">
                    <i class="fas fa-keyboard mr-1"></i> Keyboard Shortcuts
                </button>
                <span class="text-gray-300 dark:text-gray-600">|</span>
                <button id="help-btn" class="clickable text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-sm flex items-center">
                    <i class="fas fa-question-circle mr-1"></i> Help
                </button>
            </div>
            <p>&copy; 2025 Ridoy Khan. All rights reserved.</p>
        </footer>
    </div>

    <!-- Toast notifications container -->
    <div id="toast-container"></div>

    <script>
     
        // ======== CORE FUNCTIONALITY ========
        
        // File system simulation
        const files = {
            'index.html': {
                content: '<!DOCTYPE html>\n<html>\n<head>\n  <title>My Page</title>\n  <style>\n    body {\n      font-family: Arial, sans-serif;\n      margin: 0;\n      padding: 20px;\n      line-height: 1.6;\n    }\n    h1 {\n      color: #4F46E5;\n    }\n  </style>\n</head>\n<body>\n  <h1>Hello, World!</h1>\n  <p>Welcome to my page.</p>\n</body>\n</html>',
                language: 'html'
            }
        };
        
        let currentFile = 'index.html';
        let autoRefresh = false;
        let autoRefreshTimer = null;
        let mrBotApiEndpoint = 'https://api.mrbot.com';
        let codeMirrorEditor;
        let currentEditorTheme = 'dracula';
        let selectedTheme = 'dracula';
        let debounceTimer;
        let highlightActiveLine = true;
        
        // Template definitions - empty as requested
        const templates = {};
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            initDarkMode();
            initCodeMirror();
            initUI();
            setupEventListeners();
            loadFile(currentFile);
            initCustomCursor();
            initModalAnimations();
        });

        function initDarkMode() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                updateCodeMirrorTheme();
            });

            document.getElementById('theme-toggle').addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                updateCodeMirrorTheme();
            });
        }

        function initCustomCursor() {
            if (!window.matchMedia("(pointer: fine)").matches) {
                return; // Don't initialize custom cursor on touch devices
            }
            
            const cursor = document.getElementById('custom-cursor');
            const cursorTrail = document.getElementById('cursor-trail');
            
            if (!cursor || !cursorTrail) return;
            
            document.addEventListener('mousemove', e => {
                cursor.style.left = e.clientX + 'px';
                cursor.style.top = e.clientY + 'px';
                
                // Create trail effect with debouncing to improve performance
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    cursorTrail.style.left = e.clientX + 'px';
                    cursorTrail.style.top = e.clientY + 'px';
                    cursorTrail.style.opacity = '1';
                    
                    setTimeout(() => {
                        cursorTrail.style.opacity = '0';
                    }, 200);
                }, 10);
            });

            document.addEventListener('mousedown', () => {
                cursor.style.transform = 'translate(-50%, -50%) scale(0.7)';
            });

            document.addEventListener('mouseup', () => {
                cursor.style.transform = 'translate(-50%, -50%) scale(1)';
            });
            
            // Fix cursor visibility when leaving/entering window
            document.addEventListener('mouseleave', () => {
                cursor.style.opacity = '0';
                cursorTrail.style.opacity = '0';
            });
            
            document.addEventListener('mouseenter', () => {
                cursor.style.opacity = '1';
            });
            
            // Special effects for clickable elements
            document.querySelectorAll('.clickable').forEach(el => {
                el.addEventListener('mouseover', () => {
                    cursor.style.width = '30px';
                    cursor.style.height = '30px';
                    cursor.style.background = 'linear-gradient(45deg, var(--accent), var(--success))';
                });
                
                el.addEventListener('mouseout', () => {
                    cursor.style.width = '20px';
                    cursor.style.height = '20px';
                    cursor.style.background = 'linear-gradient(45deg, var(--primary), var(--secondary))';
                });
            });
        }

        function initModalAnimations() {
            // Show modals with animation
            const modals = ['shortcuts-modal', 'add-file-modal', 'ai-helper-modal', 'theme-modal'];
            
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (!modal) return;
                
                modal.addEventListener('transitionend', function(e) {
                    if (this.classList.contains('hidden')) return;
                    
                    const content = this.querySelector('.modal-content');
                    if (content) {
                        content.classList.remove('scale-95', 'opacity-0');
                        content.classList.add('scale-100', 'opacity-100');
                    }
                });
            });
        }

        function initCodeMirror() {
            // Initialize CodeMirror editor with better defaults
            codeMirrorEditor = CodeMirror(document.getElementById('code-mirror-editor'), {
                mode: 'htmlmixed',
                lineNumbers: true,
                theme: currentEditorTheme,
                lineWrapping: true,
                matchBrackets: true,
                autoCloseTags: true,
                indentUnit: 2,
                tabSize: 2,
                indentWithTabs: false,
                styleActiveLine: highlightActiveLine,
                foldGutter: true,
                gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
                extraKeys: {
                    "Cmd-Enter": runCode,
                    "Ctrl-Enter": runCode,
                    "Shift-Alt-F": formatCode,
                    "Cmd-S": saveCurrentFile,
                    "Ctrl-S": saveCurrentFile,
                    "Cmd-F": function(cm) {
                        document.getElementById('search-input').focus();
                    },
                    "Ctrl-F": function(cm) {
                        document.getElementById('search-input').focus();
                    },
                    "Alt-1": () => document.querySelector('.code-tab[data-target="preview-section"]').click(),
                    "Alt-2": () => document.querySelector('.code-tab[data-target="console-section"]').click(),
                    "Alt-3": () => document.querySelector('.code-tab[data-target="source-section"]').click(),
                    "Cmd-/": cm => {
                        cm.toggleComment({ indent: true });
                    },
                    "Ctrl-/": cm => {
                        cm.toggleComment({ indent: true });
                    }
                }
            });
            
            codeMirrorEditor.on('change', () => {
                updateCharCount();
                updateLineCount();
                saveCurrentFile();
                
                // Auto-refresh feature with debouncing
                if (autoRefresh) {
                    clearTimeout(autoRefreshTimer);
                    autoRefreshTimer = setTimeout(() => {
                        runCode();
                    }, 1000);
                }
            });
            
            // Set initial content
            codeMirrorEditor.setValue(files[currentFile].content);
            
            // Handle selection changes and cursor movement
            codeMirrorEditor.on('cursorActivity', updateSelectionInfo);
            
            // Update theme based on dark mode
            updateCodeMirrorTheme();
        }

        function updateCodeMirrorTheme() {
            const isDark = document.documentElement.classList.contains('dark');
            
            // Adjust theme based on both selected theme and dark mode
            if (selectedTheme === 'default') {
                codeMirrorEditor.setOption('theme', isDark ? 'material' : 'default');
            } else {
                codeMirrorEditor.setOption('theme', selectedTheme);
            }
            
            currentEditorTheme = codeMirrorEditor.getOption('theme');
            
            // Update active line highlighting to ensure contrast with editor background
            if (isDark) {
                document.documentElement.style.setProperty('--editor-selected-line', 'var(--editor-selected-line-dark)');
                document.documentElement.style.setProperty('--editor-selection-bg', 'var(--editor-selection-bg-dark)');
            } else {
                document.documentElement.style.setProperty('--editor-selected-line', 'var(--editor-selected-line-light)');
                document.documentElement.style.setProperty('--editor-selection-bg', 'var(--editor-selection-bg-light)');
            }
        }

        function initUI() {
            // Update counts
            updateCharCount();
            updateLineCount();
            
            // Initialize tooltips
            initTooltips();
            
            // Initialize console
            initConsole();
            
            // Setup code tabs
            setupCodeTabs();
            
            // Initialize search buttons
            initializeSearchButtons();
            
            // Set active theme in theme selector
            document.querySelectorAll('.theme-option').forEach(option => {
                if (option.getAttribute('data-theme') === currentEditorTheme) {
                    option.classList.add('active');
                }
            });
        }
        
        function initializeSearchButtons() {
            const searchInput = document.getElementById('search-input');
            const searchButtonsContainer = document.createElement('div');
            searchButtonsContainer.id = 'search-buttons';
            searchButtonsContainer.className = 'search-buttons';
            
            const prevButton = document.createElement('button');
            prevButton.className = 'search-button';
            prevButton.innerHTML = '<i class="fas fa-chevron-up"></i>';
            prevButton.title = 'Previous match (Shift+Enter)';
            prevButton.id = 'search-prev-btn';
            
            const nextButton = document.createElement('button');
            nextButton.className = 'search-button';
            nextButton.innerHTML = '<i class="fas fa-chevron-down"></i>';
            nextButton.title = 'Next match (Enter)';
            nextButton.id = 'search-next-btn';
            
            searchButtonsContainer.appendChild(prevButton);
            searchButtonsContainer.appendChild(nextButton);
            
            // Update the parent container to ensure proper positioning
            searchInput.parentNode.style.position = 'relative';
            searchInput.parentNode.appendChild(searchButtonsContainer);
        }

        function setupCodeTabs() {
            const tabs = document.querySelectorAll('.code-tab');
            const sections = document.querySelectorAll('[id$="-section"]');
            
            // Hide all sections except the first one
            for (let i = 1; i < sections.length; i++) {
                sections[i].classList.add('hidden');
            }
            
            // Activate the first tab
            tabs[0].classList.add('active');
            
            // Add click event listener to each tab
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const target = tab.getAttribute('data-target');
                    
                    // Hide all sections and deactivate all tabs
                    sections.forEach(section => {
                        section.classList.add('hidden');
                    });
                    tabs.forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    // Show the target section and activate the clicked tab
                    document.getElementById(target).classList.remove('hidden');
                    tab.classList.add('active');
                });
            });
        }

        function initTooltips() {
            const tooltips = document.querySelectorAll('[id$="tooltip"]');
            
            tooltips.forEach(tooltip => {
                const targetId = tooltip.id.replace('-tooltip', '');
                const targetElement = document.getElementById(targetId);
                
                if (targetElement) {
                    targetElement.addEventListener('mouseenter', () => {
                        const rect = targetElement.getBoundingClientRect();
                        tooltip.style.left = `${rect.left}px`;
                        tooltip.style.top = `${rect.bottom + 5}px`;
                        tooltip.classList.add('show-tooltip');
                    });
                    
                    targetElement.addEventListener('mouseleave', () => {
                        tooltip.classList.remove('show-tooltip');
                    });
                }
            });
        }

        function initConsole() {
            // Override console methods to capture output
            const consoleOutput = document.getElementById('console-output');
            
            // Store original console methods
            const originalConsole = {
                log: console.log,
                error: console.error,
                warn: console.warn,
                info: console.info,
                clear: console.clear
            };
            
            // Override console.log
            console.log = function(...args) {
                const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg).join(' ');
                addConsoleMessage(message, 'log');
                originalConsole.log.apply(console, args);
            };
            
            // Override console.error
            console.error = function(...args) {
                const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg).join(' ');
                addConsoleMessage(message, 'error');
                originalConsole.error.apply(console, args);
            };
            
            // Override console.warn
            console.warn = function(...args) {
                const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg).join(' ');
                addConsoleMessage(message, 'warn');
                originalConsole.warn.apply(console, args);
            };
            
            // Override console.info
            console.info = function(...args) {
                const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg).join(' ');
                addConsoleMessage(message, 'info');
                originalConsole.info.apply(console, args);
            };
            
            // Override console.clear
            console.clear = function() {
                clearConsole();
                originalConsole.clear.apply(console);
            };
            
            // Clear console button
            document.getElementById('clear-console-btn').addEventListener('click', clearConsole);
        }

        function addConsoleMessage(message, type = 'log') {
            const consoleOutput = document.getElementById('console-output');
            const messageElement = document.createElement('div');
            messageElement.className = `console-log ${type !== 'log' ? `console-${type}` : ''}`;
            
            // Add appropriate icon based on message type
            let icon = '';
            if (type === 'error') icon = '<i class="fas fa-times-circle mr-2"></i>';
            else if (type === 'warn') icon = '<i class="fas fa-exclamation-triangle mr-2"></i>';
            else if (type === 'info') icon = '<i class="fas fa-info-circle mr-2"></i>';
            else icon = '<i class="fas fa-arrow-right mr-2 text-green-400"></i>';
            
            messageElement.innerHTML = `${icon}${escapeHTML(message)}`;
            consoleOutput.appendChild(messageElement);
            
            // Auto-scroll to the bottom
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function clearConsole() {
            const consoleOutput = document.getElementById('console-output');
            consoleOutput.innerHTML = '';
            addConsoleMessage('Console cleared', 'info');
        }

        function setupEventListeners() {
            // Developer Tools panel toggle
            document.getElementById('tools-header').addEventListener('click', () => {
                const toolsContent = document.getElementById('tools-content');
                const toolsChevron = document.getElementById('tools-chevron');
                
                if (toolsContent.classList.contains('max-h-0')) {
                    toolsContent.classList.remove('max-h-0');
                    toolsContent.classList.add('max-h-96');
                    toolsChevron.style.transform = 'rotate(180deg)';
                } else {
                    toolsContent.classList.remove('max-h-96');
                    toolsContent.classList.add('max-h-0');
                    toolsChevron.style.transform = 'rotate(0)';
                }
            });
            
            // Device preview buttons
            document.querySelectorAll('.device-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const device = btn.getAttribute('data-device');
                    document.getElementById('device-selector').value = device;
                    updateDevicePreview(device);
                });
            });
            
            // Device selector
            document.getElementById('device-selector').addEventListener('change', (e) => {
                updateDevicePreview(e.target.value);
            });
            
            // Auto-refresh toggle
            document.getElementById('auto-refresh-toggle').addEventListener('click', () => {
                autoRefresh = !autoRefresh;
                const toggleBtn = document.getElementById('auto-refresh-toggle');
                
                if (autoRefresh) {
                    toggleBtn.innerHTML = '<i class="fas fa-sync-alt mr-2 text-green-500"></i><span>Auto-refresh: On</span>';
                    toggleBtn.classList.add('bg-green-50', 'dark:bg-green-900');
                    toggleBtn.classList.remove('bg-gray-100', 'dark:bg-gray-800');
                    runCode(); // Run immediately when turned on
                } else {
                    toggleBtn.innerHTML = '<i class="fas fa-sync-alt mr-2 text-indigo-500"></i><span>Auto-refresh: Off</span>';
                    toggleBtn.classList.remove('bg-green-50', 'dark:bg-green-900');
                    toggleBtn.classList.add('bg-gray-100', 'dark:bg-gray-800');
                    clearTimeout(autoRefreshTimer);
                }
            });
            
            // Run code button
            document.getElementById('run-btn').addEventListener('click', () => {
                saveScrollPosition();
                runCode();
                animateButton('run-btn');
            });
            
            // Clear code button
            document.getElementById('clear-btn').addEventListener('click', () => {
                if (confirm('Are you sure you want to clear the editor?')) {
                    codeMirrorEditor.setValue('');
                    saveCurrentFile();
                    updateCharCount();
                    updateLineCount();
                }
            });
            
            // Copy code button
            document.getElementById('copy-btn').addEventListener('click', () => {
                const code = codeMirrorEditor.getValue();
                navigator.clipboard.writeText(code).then(() => {
                    showToast('Code copied to clipboard!');
                    animateButton('copy-btn');
                }).catch(err => {
                    showToast('Failed to copy code: ' + err, 'error');
                });
            });
            
            // Refresh preview button
            document.getElementById('refresh-btn').addEventListener('click', () => {
                saveScrollPosition();
                runCode();
                animateButton('refresh-btn');
            });
            
            // New window button
            document.getElementById('new-window-btn').addEventListener('click', () => {
                const content = codeMirrorEditor.getValue();
                const newWindow = window.open('', '_blank');
                newWindow.document.write(content);
                newWindow.document.close();
            });
            
            // Format code button
            document.getElementById('indent-btn').addEventListener('click', () => {
                formatCode();
                animateButton('indent-btn');
            });
            
            // Language selector
            document.getElementById('language-selector').addEventListener('change', (e) => {
                files[currentFile].language = e.target.value;
                updateCodeMirrorMode(e.target.value);
                
                // Update syntax highlighting in source view
                updateSourceView();
            });
            
            // Theme code button
            document.getElementById('theme-code-btn').addEventListener('click', () => {
                document.getElementById('theme-modal').classList.remove('hidden');
            });
            
            // Theme options
            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', () => {
                    // Remove active class from all options
                    document.querySelectorAll('.theme-option').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    
                    // Add active class to selected option
                    option.classList.add('active');
                    
                    // Store the selected theme
                    selectedTheme = option.getAttribute('data-theme');
                });
            });
            
            // Active line highlighting toggle
            document.getElementById('highlight-active-line').addEventListener('change', (e) => {
                highlightActiveLine = e.target.checked;
                codeMirrorEditor.setOption('styleActiveLine', highlightActiveLine);
            });
            
            // Apply theme button
            document.getElementById('apply-theme-btn').addEventListener('click', () => {
                codeMirrorEditor.setOption('theme', selectedTheme);
                currentEditorTheme = selectedTheme;
                document.getElementById('theme-modal').classList.add('hidden');
                
                // Reset modal animation
                setTimeout(() => {
                    document.getElementById('theme-modal-content').classList.add('scale-95', 'opacity-0');
                    document.getElementById('theme-modal-content').classList.remove('scale-100', 'opacity-100');
                }, 300);
                
                updateCodeMirrorTheme();
                showToast(`Theme changed to ${selectedTheme}`, 'success');
            });
            
            // Close theme modal button
            document.getElementById('close-theme-modal-btn').addEventListener('click', () => {
                document.getElementById('theme-modal').classList.add('hidden');
                
                // Reset modal animation
                setTimeout(() => {
                    document.getElementById('theme-modal-content').classList.add('scale-95', 'opacity-0');
                    document.getElementById('theme-modal-content').classList.remove('scale-100', 'opacity-100');
                }, 300);
            });
            
            // Save button
            document.getElementById('save-btn').addEventListener('click', () => {
                saveCurrentFile();
                showToast('File saved successfully!');
                animateButton('save-btn');
            });
            
            // Add file button
            document.getElementById('add-file-btn').addEventListener('click', () => {
                document.getElementById('add-file-modal').classList.remove('hidden');
            });
            
            // Close modal buttons
            document.getElementById('close-modal-btn').addEventListener('click', () => {
                document.getElementById('add-file-modal').classList.add('hidden');
                
                // Reset modal animation
                setTimeout(() => {
                    document.getElementById('add-file-modal-content').classList.add('scale-95', 'opacity-0');
                    document.getElementById('add-file-modal-content').classList.remove('scale-100', 'opacity-100');
                }, 300);
            });
            
            document.getElementById('cancel-file-btn').addEventListener('click', () => {
                document.getElementById('add-file-modal').classList.add('hidden');
                
                // Reset modal animation
                setTimeout(() => {
                    document.getElementById('add-file-modal-content').classList.add('scale-95', 'opacity-0');
                    document.getElementById('add-file-modal-content').classList.remove('scale-100', 'opacity-100');
                }, 300);
            });
            
            // Create file button
            document.getElementById('create-file-btn').addEventListener('click', () => {
                createNewFile();
            });
            
            // Keyboard shortcuts button
            document.getElementById('shortcuts-btn').addEventListener('click', () => {
                document.getElementById('shortcuts-modal').classList.remove('hidden');
            });
            
            // Close shortcuts modal buttons
            document.getElementById('close-shortcuts-btn').addEventListener('click', () => {
                document.getElementById('shortcuts-modal').classList.add('hidden');
                
                // Reset modal animation
                setTimeout(() => {
                    document.getElementById('shortcuts-modal-content').classList.add('scale-95', 'opacity-0');
                    document.getElementById('shortcuts-modal-content').classList.remove('scale-100', 'opacity-100');
                }, 300);
            });
            
            document.getElementById('dismiss-shortcuts-btn').addEventListener('click', () => {
                document.getElementById('shortcuts-modal').classList.add('hidden');
                
                // Reset modal animation
                setTimeout(() => {
                    document.getElementById('shortcuts-modal-content').classList.add('scale-95', 'opacity-0');
                    document.getElementById('shortcuts-modal-content').classList.remove('scale-100', 'opacity-100');
                }, 300);
            });
            
            // AI Helper button
            document.getElementById('ai-helper-btn').addEventListener('click', () => {
                document.getElementById('ai-helper-modal').classList.remove('hidden');
            });
            
            // Close AI Helper modal button
            document.getElementById('close-ai-modal-btn').addEventListener('click', () => {
                document.getElementById('ai-helper-modal').classList.add('hidden');
                
                // Reset modal animation
                setTimeout(() => {
                    document.getElementById('ai-helper-modal-content').classList.add('scale-95', 'opacity-0');
                    document.getElementById('ai-helper-modal-content').classList.remove('scale-100', 'opacity-100');
                }, 300);
            });
            
            // AI quick actions
            document.querySelectorAll('.ai-quick-action').forEach(btn => {
                btn.addEventListener('click', () => {
                    const prompt = btn.innerText.trim();
                    document.getElementById('ai-prompt').value = prompt;
                });
            });
            
            // Send to AI button
            document.getElementById('send-to-ai-btn').addEventListener('click', () => {
                const prompt = document.getElementById('ai-prompt').value.trim();
                if (prompt) {
                    showToast('Sending request to MR Bot...', 'info');
                    document.getElementById('ai-helper-modal').classList.add('hidden');
                    
                    // Reset modal animation
                    setTimeout(() => {
                        document.getElementById('ai-helper-modal-content').classList.add('scale-95', 'opacity-0');
                        document.getElementById('ai-helper-modal-content').classList.remove('scale-100', 'opacity-100');
                    }, 300);
                    
                    const currentCode = codeMirrorEditor.getValue();
                    const language = files[currentFile].language;
                    
                    // Use MR Bot API
                    sendToMrBotAPI(prompt, currentCode, language);
                } else {
                    showToast('Please enter a prompt for the AI', 'error');
                }
            });
            
            // HTML validator button
            document.getElementById('validate-html-btn').addEventListener('click', () => {
                const currentFileType = files[currentFile].language;
                if (currentFileType === 'html') {
                    validateHTML();
                } else {
                    showToast('HTML validation requires an HTML file', 'error');
                }
            });
            
            // CSS beautifier button
            document.getElementById('beautify-css-btn').addEventListener('click', () => {
                const currentFileType = files[currentFile].language;
                if (currentFileType === 'css') {
                    formatCode();
                    showToast('CSS code formatted successfully!', 'success');
                } else {
                    showToast('CSS beautifier requires a CSS file', 'error');
                }
            });
            
            // JS formatter button
            document.getElementById('format-js-btn').addEventListener('click', () => {
                const currentFileType = files[currentFile].language;
                if (currentFileType === 'javascript' || currentFileType === 'js') {
                    formatCode();
                    showToast('JavaScript code formatted successfully!', 'success');
                } else {
                    showToast('JS formatter requires a JavaScript file', 'error');
                }
            });
            
            // Minify code button
            document.getElementById('minify-code-btn').addEventListener('click', () => {
                minifyCode();
            });
            
            // Help button
            document.getElementById('help-btn').addEventListener('click', () => {
                // Open keyboard shortcuts as a form of help
                document.getElementById('shortcuts-modal').classList.remove('hidden');
            });
            
            // When clicking on a file tab
            document.getElementById('file-tabs-container').addEventListener('click', (e) => {
                const fileTab = e.target.closest('.file-tab');
                if (fileTab) {
                    const closeBtn = e.target.closest('.file-tab button');
                    if (closeBtn) {
                        // If clicking the close button
                        const filename = fileTab.getAttribute('data-filename');
                        if (Object.keys(files).length > 1) {
                            deleteFile(filename);
                        } else {
                            showToast('Cannot delete the last file', 'error');
                        }
                    } else {
                        // If clicking the tab itself
                        const filename = fileTab.getAttribute('data-filename');
                        if (filename !== currentFile) {
                            saveCurrentFile();
                            loadFile(filename);
                        }
                    }
                }
            });
            
            // Social share buttons
            document.getElementById('share-twitter').addEventListener('click', () => {
                shareOnSocial('twitter');
            });
            
            document.getElementById('share-facebook').addEventListener('click', () => {
                shareOnSocial('facebook');
            });
            
            document.getElementById('share-linkedin').addEventListener('click', () => {
                shareOnSocial('linkedin');
            });
            
            document.getElementById('share-whatsapp').addEventListener('click', () => {
                shareOnSocial('whatsapp');
            });
            
            document.getElementById('share-email').addEventListener('click', () => {
                shareOnSocial('email');
            });
            
            // Generate shareable link
            document.getElementById('create-link').addEventListener('click', () => {
                generateShareableLink();
            });
            
            // Copy shareable link
            document.getElementById('copy-link-btn').addEventListener('click', () => {
                const linkInput = document.getElementById('share-link');
                linkInput.select();
                navigator.clipboard.writeText(linkInput.value).then(() => {
                    showToast('Link copied to clipboard!', 'success');
                }).catch(err => {
                    showToast('Failed to copy link: ' + err, 'error');
                });
            });
            
            // Enhanced search functionality
            document.getElementById('search-input').addEventListener('input', function() {
                const query = this.value.toLowerCase();
                if (!query) {
                    // Clear all highlights if search is empty
                    codeMirrorEditor.getAllMarks().forEach(mark => mark.clear());
                    const countDisplay = document.getElementById('search-highlight-count');
                    countDisplay.classList.add('hidden');
                    return;
                }
                
                // Clear previous highlights
                codeMirrorEditor.getAllMarks().forEach(mark => mark.clear());
                
                // Add CSS for highlighting search results
                if (!document.getElementById('search-highlight-style')) {
                    const style = document.createElement('style');
                    style.id = 'search-highlight-style';
                    style.innerHTML = `
                        .search-highlight {
                            background-color: rgba(93, 92, 222, 0.3);
                        }
                        .search-highlight-selected {
                            background-color: rgba(255, 215, 0, 0.5);
                        }
                        .dark .search-highlight {
                            background-color: rgba(93, 92, 222, 0.5);
                        }
                        .dark .search-highlight-selected {
                            background-color: rgba(255, 215, 0, 0.7);
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                // Search the document for matches
                let cursor = codeMirrorEditor.getSearchCursor(query, { line: 0, ch: 0 }, { caseFold: true });
                let foundCount = 0;
                let firstLine = null;
                
                while (cursor.findNext()) {
                    foundCount++;
                    const from = cursor.from();
                    const to = cursor.to();
                    
                    if (!firstLine) firstLine = from.line;
                    
                    // Mark the occurrence
                    codeMirrorEditor.markText(from, to, { 
                        className: 'search-highlight',
                        clearOnEnter: false
                    });
                }
                
                // Update count display
                const countDisplay = document.getElementById('search-highlight-count');
                if (foundCount > 0) {
                    countDisplay.textContent = `${foundCount}`;
                    countDisplay.classList.remove('hidden');
                } else {
                    countDisplay.classList.add('hidden');
                }
                
                // Scroll to first result if found
                if (firstLine !== null) {
                    codeMirrorEditor.scrollIntoView({line: firstLine, ch: 0}, 100);
                    showToast(`Found ${foundCount} matches`, 'info', 1500);
                } else {
                    showToast('No matches found', 'info', 1500);
                }
            });
            
            // Search navigation (next/previous)
            let currentMatch = 0;
            
            function highlightCurrentMatch() {
                // Remove previous selection highlight
                codeMirrorEditor.getAllMarks().forEach(mark => {
                    if (mark.className === 'search-highlight-selected') {
                        mark.clear();
                    }
                });
                
                // Get all highlight marks
                const marks = codeMirrorEditor.getAllMarks().filter(mark => 
                    mark.className === 'search-highlight'
                );
                
                if (marks.length > 0) {
                    // Ensure currentMatch is within bounds (use modulo for wrapping)
                    currentMatch = (currentMatch + marks.length) % marks.length;
                    
                    const current = marks[currentMatch];
                    if (current) {
                        const pos = current.find();
                        
                        if (pos) {
                            // Add special highlight to current match
                            codeMirrorEditor.markText(pos.from, pos.to, { 
                                className: 'search-highlight-selected',
                                clearOnEnter: false
                            });
                            
                            // Scroll to the match
                            codeMirrorEditor.scrollIntoView({
                                from: pos.from,
                                to: pos.to
                            }, 100);
                            
                            showToast(`Match ${currentMatch + 1} of ${marks.length}`, 'info', 1500);
                        }
                    }
                }
            }
            
            // Set up event listeners for search navigation
            document.getElementById('search-next-btn').addEventListener('click', () => {
                currentMatch++;
                highlightCurrentMatch();
            });
            
            document.getElementById('search-prev-btn').addEventListener('click', () => {
                currentMatch--;
                highlightCurrentMatch();
            });
            
            // Search input keyboard shortcuts
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    if (e.shiftKey) {
                        // Shift+Enter for previous
                        e.preventDefault();
                        currentMatch--;
                        highlightCurrentMatch();
                    } else {
                        // Enter for next
                        e.preventDefault();
                        currentMatch++;
                        highlightCurrentMatch();
                    }
                }
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Run Code: Cmd/Ctrl + Enter
                if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
                    e.preventDefault();
                    saveScrollPosition();
                    runCode();
                    animateButton('run-btn');
                }
                
                // Format Code: Shift + Alt + F
                if (e.shiftKey && e.altKey && e.key === 'F') {
                    e.preventDefault();
                    formatCode();
                    animateButton('indent-btn');
                }
                
                // Save: Cmd/Ctrl + S
                if ((e.metaKey || e.ctrlKey) && e.key === 'S') {
                    e.preventDefault();
                    saveCurrentFile();
                    showToast('File saved successfully!');
                    animateButton('save-btn');
                }
                
                // Find: Cmd/Ctrl + F
                if ((e.metaKey || e.ctrlKey) && e.key === 'f') {
                    e.preventDefault();
                    document.getElementById('search-input').focus();
                }
                
                // Switch tabs: Alt + 1, Alt + 2, Alt + 3
                if (e.altKey && e.key === '1') {
                    e.preventDefault();
                    document.querySelector('.code-tab[data-target="preview-section"]').click();
                }
                if (e.altKey && e.key === '2') {
                    e.preventDefault();
                    document.querySelector('.code-tab[data-target="console-section"]').click();
                }
                if (e.altKey && e.key === '3') {
                    e.preventDefault();
                    document.querySelector('.code-tab[data-target="source-section"]').click();
                }
                
                // Toggle developer tools: Cmd/Ctrl + Shift + D
                if ((e.metaKey || e.ctrlKey) && e.shiftKey && e.key === 'D') {
                    e.preventDefault();
                    document.getElementById('tools-header').click();
                }
            });
        }

        function updateCodeMirrorMode(language) {
            let mode;
            switch (language) {
                case 'html':
                    mode = 'htmlmixed';
                    break;
                case 'css':
                    mode = 'css';
                    break;
                case 'javascript':
                case 'js':
                    mode = 'javascript';
                    break;
                case 'typescript':
                case 'ts':
                    mode = {name: 'javascript', typescript: true};
                    break;
                case 'python':
                case 'py':
                    mode = 'python';
                    break;
                case 'json':
                    mode = {name: 'javascript', json: true};
                    break;
                case 'xml':
                    mode = 'xml';
                    break;
                default:
                    mode = 'htmlmixed';
            }
            
            codeMirrorEditor.setOption('mode', mode);
        }

        function sendToMrBotAPI(prompt, code, language) {
            // Show loading state with animated toast
            const loadingToastId = showToast('Processing with MR Bot...', 'info', 0);
            
            // Switch to console and show the "response"
            document.querySelector('.code-tab[data-target="console-section"]').click();
            clearConsole();
            
            console.info('💬 Sending to MR Bot API');
            console.log(`Endpoint: ${mrBotApiEndpoint}`);
            console.log(`Language: ${language}`);
            console.log(`Prompt: ${prompt}`);
            
            // Add loading message to console
            const loadingIndicator = document.createElement('div');
            loadingIndicator.className = 'console-log';
            loadingIndicator.style.display = 'flex';
            loadingIndicator.style.alignItems = 'center';
            loadingIndicator.innerHTML = '<div class="mr-2" style="width: 20px; height: 20px; border: 2px solid rgba(93, 92, 222, 0.3); border-top-color: #5D5CDE; border-radius: 50%; animation: spin 1s linear infinite;"></div> Processing request...';
            document.getElementById('console-output').appendChild(loadingIndicator);
            
            // Add keyframe animation for the spinner
            const style = document.createElement('style');
            style.innerHTML = `
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
            
            // Simulate API response with a delay
            setTimeout(() => {
                // Remove the loading indicator
                loadingIndicator.remove();
                
                // Remove the loading toast
                removeToast(loadingToastId);
                showToast('Received response from MR Bot', 'success');
                
                console.info('💬 MR Bot Response:');
                console.log('Analyzing your ' + language + ' code...');
                
                // Simulate different responses based on the prompt
                if (prompt.includes('fix') || prompt.includes('error')) {
                    console.log('✅ No critical errors found in your code.');
                    console.log('🔍 Suggestions:');
                    console.log('1. Consider adding more comments to explain complex logic');
                    console.log('2. Optimize CSS selectors for better performance');
                    console.log('3. Add proper error handling for any API calls');
                    
                    setTimeout(() => {
                        console.warn('⚠️ Line 15: Unused variable detected');
                        console.warn('⚠️ Line 27: Consider using const instead of let for variables that don\'t change');
                    }, 500);
                } else if (prompt.includes('optimize')) {
                    console.log('🚀 Optimization opportunities:');
                    console.log('1. Reduce unused CSS by 15%');
                    console.log('2. Implement code splitting for better loading times');
                    console.log('3. Use CSS Grid instead of nested flexbox for the layout');
                    
                    setTimeout(() => {
                        console.info('💡 Performance tip: Consider lazy loading images');
                        console.info('💡 Performance tip: Minify your CSS and JavaScript for production');
                    }, 600);
                } else if (prompt.includes('explain')) {
                    console.log('📚 Code explanation:');
                    console.log('Your code implements a responsive web interface with:');
                    console.log('- Modern CSS layout techniques');
                    console.log('- Event handling for user interactions');
                    console.log('- DOM manipulation to update content dynamically');
                    
                    setTimeout(() => {
                        console.info('💡 The structure uses HTML5 semantic elements for better accessibility');
                        console.info('💡 Event listeners are using modern JavaScript patterns');
                    }, 700);
                } else if (prompt.includes('Add a feature')) {
                    console.log('🔍 Analyzing code structure for feature integration...');
                    
                    setTimeout(() => {
                        console.log('✅ Code structure allows for the following features:');
                        console.log('1. Dark mode toggle with user preference storage');
                        console.log('2. Code sharing via URL parameters');
                        console.log('3. Auto-save functionality with localStorage');
                        console.info('💡 Recommendation: Add dark mode toggle in the header area');
                    }, 800);
                } else {
                    console.log('Your code looks good! Here are some general improvements:');
                    console.log('1. Add proper documentation');
                    console.log('2. Consider adding unit tests');
                    console.log('3. Optimize for mobile devices');
                    
                    setTimeout(() => {
                        console.info('💡 Use consistent naming conventions throughout your code');
                        console.info('💡 Consider implementing error boundaries for production');
                    }, 600);
                }
            }, 2000);
        }

        function shareOnSocial(platform) {
            const currentUrl = window.location.href;
            const text = encodeURIComponent('Check out my code on CodeCraft Pro Runner!');
            
            let shareUrl;
            
            switch (platform) {
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?text=${text}&url=${encodeURIComponent(currentUrl)}`;
                    break;
                case 'facebook':
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(currentUrl)}`;
                    break;
                case 'linkedin':
                    shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(currentUrl)}`;
                    break;
                case 'whatsapp':
                    shareUrl = `https://wa.me/?text=${text}%20${encodeURIComponent(currentUrl)}`;
                    break;
                case 'email':
                    shareUrl = `mailto:?subject=${text}&body=${encodeURIComponent('Check out my code: ' + currentUrl)}`;
                    break;
                default:
                    showToast('Sharing platform not supported', 'error');
                    return;
            }
            
            window.open(shareUrl, '_blank');
            showToast(`Sharing on ${platform}`, 'success');
        }

        function generateShareableLink() {
            const currentCode = codeMirrorEditor.getValue();
            
            // Add loading animation
            const linkButton = document.getElementById('create-link');
            linkButton.innerHTML = '<i class="fas fa-circle-notch fa-spin mr-2"></i> Generating...';
            linkButton.disabled = true;
            
            setTimeout(() => {
                // In a real app, this would use a backend API to generate a shorter link
                // or store the code in a database and return a unique ID
                const shareLink = `${window.location.href}?code=${encodeURIComponent(currentCode.substring(0, 100))}...`;
                
                const shareLinkContainer = document.getElementById('share-link-container');
                const shareLinkInput = document.getElementById('share-link');
                
                shareLinkInput.value = shareLink;
                shareLinkContainer.classList.remove('hidden');
                
                // Remove loading animation
                linkButton.innerHTML = '<i class="fas fa-link mr-2"></i> Generate Shareable Link';
                linkButton.disabled = false;
                
                showToast('Shareable link generated!', 'success');
            }, 1200);
        }

        function runCode() {
            const previewSection = document.getElementById('preview-section');
            const previewContainer = document.getElementById('preview-container');
            const outputDisplay = document.getElementById('output-display');
            const previewLoading = document.getElementById('preview-loading');
            const code = codeMirrorEditor.getValue();

            // Show loading spinner
            previewLoading.classList.remove('hidden');
            
            // Add a subtle animation to the preview container
            previewContainer.classList.add('animate-pulse-slow');
            
            // Clear any previous iframe
            if (document.getElementById('preview-frame')) {
                document.getElementById('preview-frame').remove();
            }
            
            setTimeout(() => {
                try {
                    // Clear any previous console output when running new code
                    clearConsole();
                    
                    // If we're running HTML, we need to set up the preview container
                    if (files[currentFile].language === 'html') {
                        // Create an iframe for isolated preview environment
                        const iframe = document.createElement('iframe');
                        iframe.id = 'preview-frame';
                        iframe.className = 'w-full h-full border-0 rounded-lg shadow-md';
                        iframe.sandbox = 'allow-scripts allow-same-origin allow-forms';
                        
                        // Clear the output display and add the iframe
                        outputDisplay.innerHTML = '';
                        outputDisplay.appendChild(iframe);
                        
                        // Set content to the iframe
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        iframeDoc.open();
                        iframeDoc.write(code);
                        iframeDoc.close();
                        
                        // Setup console logging in the iframe
                        setupIframeConsole(iframe);
                        
                        // Add transition effect to the iframe
                        iframe.style.opacity = '0';
                        iframe.style.transform = 'scale(0.98)';
                        iframe.style.transition = 'opacity 0.5s, transform 0.5s';
                        
                        // After a short delay, fade in the iframe
                        setTimeout(() => {
                            iframe.style.opacity = '1';
                            iframe.style.transform = 'scale(1)';
                            
                            // Restore scroll position after a short delay
                            setTimeout(restoreScrollPosition, 200);
                        }, 100);
                        
                    } else if (files[currentFile].language === 'css') {
                        outputDisplay.innerHTML = `
                            <style>${code}</style>
                            <div class="p-4 h-full overflow-auto">
                                <div class="p-4 border border-gray-200 dark:border-gray-700 rounded-lg shadow-md">
                                    <h3 class="text-lg font-medium mb-4 bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent">CSS Preview</h3>
                                    <p class="mb-3">This CSS is applied to this container:</p>
                                    <div class="grid grid-cols-2 gap-4 mb-3">
                                        <div class="p-4 border border-gray-200 rounded bg-white shadow-sm transform transition-all duration-300 hover:scale-105">Element 1</div>
                                        <div class="p-4 border border-gray-200 rounded bg-white shadow-sm transform transition-all duration-300 hover:scale-105">Element 2</div>
                                    </div>
                                    <div class="p-4 border border-gray-200 rounded bg-white shadow-sm transform transition-all duration-300 hover:scale-105">Element 3</div>
                                </div>
                            </div>`;
                            
                        // Restore scroll position
                        setTimeout(restoreScrollPosition, 100);
                    } else if (files[currentFile].language === 'javascript' || files[currentFile].language === 'js') {
                        outputDisplay.innerHTML = `
                            <div class="p-4 h-full overflow-auto">
                                <div class="mb-3 text-sm bg-blue-50 dark:bg-blue-900/30 p-3 rounded-lg shadow-sm">
                                    <i class="fas fa-info-circle mr-2 text-blue-500"></i>JavaScript output appears in the Console tab
                                </div>
                                <div id="js-output" class="p-4 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-900 text-sm font-mono h-64 overflow-auto shadow-inner"></div>
                            </div>`;
                        
                        // Create a safe eval environment
                        try {
                            const output = document.getElementById('js-output');
                            output.innerHTML = '<div class="text-xs text-gray-500 mb-2">// Executing JavaScript...</div>';
                            
                            // Switch to console tab with animation
                            const consoleTab = document.querySelector('.code-tab[data-target="console-section"]');
                            consoleTab.classList.add('bouncy');
                            setTimeout(() => consoleTab.classList.remove('bouncy'), 600);
                            consoleTab.click();
                            
                            // Add a small delay to allow console tab to show
                            setTimeout(() => {
                                // Evaluate the code
                                console.info('⚡️ Executing JavaScript code...');
                                
                                // Add try-catch wrapper around the code
                                const evalCode = `
                                    try {
                                        ${code}
                                        
                                        // Return any variables in the global scope
                                        const globals = {};
                                        for (const key in window) {
                                            if (window.hasOwnProperty(key) && typeof window[key] !== 'function' && key !== 'window' && key !== 'document' && typeof window[key] !== 'object') {
                                                globals[key] = window[key];
                                            }
                                        }
                                        
                                        console.log('📤 Global variables:', globals);
                                        console.info('✅ JavaScript execution completed');
                                    } catch (error) {
                                        console.error('🛑 Error:', error.message);
                                        console.error('📊 Stack trace:', error.stack);
                                        
                                        // Highlight the error line in the editor
                                        highlightErrorLine(error);
                                    }
                                `;
                                
                                // Run the code
                                eval(evalCode);
                            }, 300);
                            
                        } catch (error) {
                            console.error('🛑 Error:', error.message);
                            
                            // Highlight the error line in the editor
                            highlightErrorLine(error);
                        }
                    } else if (files[currentFile].language === 'typescript' || files[currentFile].language === 'ts') {
                        outputDisplay.innerHTML = `
                            <div class="p-4 h-full overflow-auto">
                                <div class="mb-3 text-yellow-600 dark:text-yellow-400 p-3 bg-yellow-50 dark:bg-yellow-900/30 rounded-lg shadow-md">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>TypeScript execution requires transpilation to JavaScript first.
                                </div>
                                <div class="p-4 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-900 text-sm font-mono h-64 overflow-auto shadow-inner">
                                    <pre class="language-typescript">${escapeHTML(code)}</pre>
                                </div>
                            </div>`;
                            
                        // Initialize syntax highlighting for the TypeScript code
                        if (window.hljs) {
                            document.querySelectorAll('pre.language-typescript').forEach(block => {
                                hljs.highlightElement(block);
                            });
                        }
                        
                        // Restore scroll position
                        setTimeout(restoreScrollPosition, 100);
                    } else if (files[currentFile].language === 'python' || files[currentFile].language === 'py') {
                        outputDisplay.innerHTML = `
                            <div class="p-4 h-full overflow-auto">
                                <div class="mb-3 text-yellow-600 dark:text-yellow-400 p-3 bg-yellow-50 dark:bg-yellow-900/30 rounded-lg shadow-md">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>Python execution is not supported in the browser environment.
                                </div>
                                <div class="p-4 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-900 text-sm font-mono h-64 overflow-auto shadow-inner">
                                    <pre class="language-python">${escapeHTML(code)}</pre>
                                </div>
                            </div>`;
                            
                        // Initialize syntax highlighting for the Python code
                        if (window.hljs) {
                            document.querySelectorAll('pre.language-python').forEach(block => {
                                hljs.highlightElement(block);
                            });
                        }
                        
                        // Restore scroll position
                        setTimeout(restoreScrollPosition, 100);
                    } else if (files[currentFile].language === 'xml') {
                        outputDisplay.innerHTML = `
                            <div class="p-4 h-full overflow-auto">
                                <pre class="p-4 font-mono text-sm bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg overflow-auto shadow-inner language-xml">${escapeHTML(code)}</pre>
                            </div>`;
                            
                        // Initialize syntax highlighting for the XML code
                        if (window.hljs) {
                            document.querySelectorAll('pre.language-xml').forEach(block => {
                                hljs.highlightElement(block);
                            });
                        }
                        
                        // Restore scroll position
                        setTimeout(restoreScrollPosition, 100);
                    } else if (files[currentFile].language === 'json') {
                        try {
                            const jsonObj = JSON.parse(code);
                            const formattedJson = JSON.stringify(jsonObj, null, 2);
                            outputDisplay.innerHTML = `
                                <div class="p-4 h-full overflow-auto">
                                    <pre class="p-4 font-mono text-sm bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg overflow-auto shadow-inner language-json">${escapeHTML(formattedJson)}</pre>
                                </div>`;
                                
                            // Initialize syntax highlighting for the JSON code
                            if (window.hljs) {
                                document.querySelectorAll('pre.language-json').forEach(block => {
                                    hljs.highlightElement(block);
                                });
                            }
                            
                            // Restore scroll position
                            setTimeout(restoreScrollPosition, 100);
                        } catch (error) {
                            outputDisplay.innerHTML = `
                                <div class="p-4 h-full overflow-auto">
                                    <div class="mb-3 text-red-600 dark:text-red-400 p-3 bg-red-50 dark:bg-red-900/30 rounded-lg shadow-md">
                                        <i class="fas fa-exclamation-circle mr-2"></i>JSON Parse Error: ${error.message}
                                    </div>
                                    <pre class="p-4 font-mono text-sm bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg overflow-auto shadow-inner">${escapeHTML(code)}</pre>
                                </div>`;
                        }
                    }
                    
                    // Update the source view as well
                    updateSourceView();
                    
                } catch (error) {
                    outputDisplay.innerHTML = `
                        <div class="text-red-500 p-4 bg-red-50 dark:bg-red-900/20 rounded-lg shadow-md">
                            <i class="fas fa-exclamation-circle mr-2"></i>Error: ${error.message}
                        </div>`;
                    console.error('Preview Error:', error.message);
                }
                
                // Hide loading spinner and remove pulse animation
                previewLoading.classList.add('hidden');
                previewContainer.classList.remove('animate-pulse-slow');
            }, 500);
        }

        function setupIframeConsole(iframe) {
            try {
                const iframeWindow = iframe.contentWindow;
                
                // Store original console methods
                const originalConsole = {
                    log: iframeWindow.console.log,
                    error: iframeWindow.console.error,
                    warn: iframeWindow.console.warn,
                    info: iframeWindow.console.info
                };
                
                // Override console methods in the iframe
                iframeWindow.console.log = function(...args) {
                    // Call original method
                    originalConsole.log.apply(iframeWindow.console, args);
                    
                    // Forward to parent console
                    const message = args.map(arg => {
                        if (arg === null) return 'null';
                        if (arg === undefined) return 'undefined';
                        return typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg);
                    }).join(' ');
                    
                    window.console.log(`[iframe] ${message}`);
                };
                
                iframeWindow.console.error = function(...args) {
                    originalConsole.error.apply(iframeWindow.console, args);
                    const message = args.map(arg => {
                        if (arg === null) return 'null';
                        if (arg === undefined) return 'undefined';
                        return typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg);
                    }).join(' ');
                    window.console.error(`[iframe] ${message}`);
                };
                
                iframeWindow.console.warn = function(...args) {
                    originalConsole.warn.apply(iframeWindow.console, args);
                    const message = args.map(arg => {
                        if (arg === null) return 'null';
                        if (arg === undefined) return 'undefined';
                        return typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg);
                    }).join(' ');
                    window.console.warn(`[iframe] ${message}`);
                };
                
                iframeWindow.console.info = function(...args) {
                    originalConsole.info.apply(iframeWindow.console, args);
                    const message = args.map(arg => {
                        if (arg === null) return 'null';
                        if (arg === undefined) return 'undefined';
                        return typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg);
                    }).join(' ');
                    window.console.info(`[iframe] ${message}`);
                };
                
                // Capture errors in the iframe
                iframeWindow.addEventListener('error', (event) => {
                    window.console.error(`[iframe] ${event.message} at line ${event.lineno}:${event.colno}`);
                    event.preventDefault();
                });
                
            } catch (e) {
                console.error('Failed to setup iframe console:', e);
            }
        }

        function updateSourceView() {
            const codeElement = document.querySelector('#code-output code');
            const language = files[currentFile].language;
            const code = codeMirrorEditor.getValue();
            
            if (!codeElement) return;
            
            codeElement.className = `language-${language}`;
            codeElement.textContent = code;
            
            // Initialize syntax highlighting
            if (window.hljs) {
                hljs.highlightElement(codeElement);
            }
        }

        function updateDevicePreview(device) {
            const previewContainer = document.getElementById('preview-container');
            
            // Remove any existing device frame classes
            previewContainer.classList.remove('device-frame', 'mobile', 'tablet');
            
            // Apply the appropriate device frame
            if (device === 'mobile') {
                previewContainer.classList.add('device-frame', 'mobile');
            } else if (device === 'tablet') {
                previewContainer.classList.add('device-frame', 'tablet');
            } else if (device === 'desktop') {
                // Desktop just uses max width
                previewContainer.style.maxWidth = '1200px';
                previewContainer.style.height = '100%';
                previewContainer.style.margin = '0 auto';
            } else {
                // Responsive uses full width
                previewContainer.style.maxWidth = '100%';
                previewContainer.style.height = '100%';
                previewContainer.style.margin = '0';
            }
            
            // Re-run the code to update the preview
            runCode();
        }

        function updateCharCount() {
            const code = codeMirrorEditor.getValue();
            document.getElementById('char-count').textContent = `${code.length} characters`;
        }

        function updateLineCount() {
            const lineCount = codeMirrorEditor.lineCount();
            document.getElementById('line-count').textContent = `${lineCount} lines`;
        }

        function updateSelectionInfo() {
            const selection = codeMirrorEditor.getSelection();
            const selectionInfo = document.getElementById('selection-info');
            
            if (selection && selection.length > 0) {
                const lines = selection.split('\n').length;
                const chars = selection.length;
                
                selectionInfo.textContent = `Selection: ${chars} chars, ${lines} lines`;
                selectionInfo.classList.remove('hidden');
            } else {
                const cursor = codeMirrorEditor.getCursor();
                selectionInfo.textContent = `Line: ${cursor.line + 1}, Col: ${cursor.ch + 1}`;
                selectionInfo.classList.remove('hidden');
            }
        }

        function highlightErrorLine(error) {
            // Clean up any previous error highlighting
            const lineCount = codeMirrorEditor.lineCount();
            for (let i = 0; i < lineCount; i++) {
                codeMirrorEditor.removeLineClass(i, 'background', 'bg-red-100');
            }
            
            // Try to extract line number from error message
            let lineNumber = null;
            const lineMatch = error.stack?.match(/at eval.*?<anonymous>:(\d+):(\d+)/) || 
                              error.stack?.match(/at .*?:(\d+):(\d+)/) ||
                              error.message.match(/line (\d+)/i);
                              
            if (lineMatch && lineMatch[1]) {
                lineNumber = parseInt(lineMatch[1], 10);
                
                // Adjust for zero-based line numbering in CodeMirror
                const effectiveLineNumber = lineNumber > 0 ? lineNumber - 1 : lineNumber;
                
                // Add error background to the line
                codeMirrorEditor.addLineClass(effectiveLineNumber, 'background', 'bg-red-100');
                
                // Add error widget to show the message
                const errorWidget = document.createElement('div');
                errorWidget.className = 'bg-red-100 text-red-800 p-1 px-2 text-xs rounded-b flex items-center';
                errorWidget.innerHTML = `<i class="fas fa-exclamation-circle mr-1"></i> ${error.message}`;
                
                // Add the widget below the error line
                codeMirrorEditor.addLineWidget(effectiveLineNumber, errorWidget, { coverGutter: false, noHScroll: true });
                
                // Scroll to the error line
                codeMirrorEditor.scrollIntoView({line: effectiveLineNumber, ch: 0}, 100);
                
                // Show the error in a toast
                showToast(`Error at line ${lineNumber}: ${error.message}`, 'error');
            }
        }

        function createNewFile() {
            const filenameInput = document.getElementById('filename-input');
            const filetypeSelect = document.getElementById('filetype-select');
            
            let filename = filenameInput.value.trim();
            const filetype = filetypeSelect.value;
            
            // Add extension if not present
            if (!filename.includes('.')) {
                filename += `.${filetype}`;
            }
            
            // Validate filename
            if (!filename) {
                showToast('Please enter a filename', 'error');
                return;
            }
            
            // Check if file already exists
            if (files[filename]) {
                showToast('A file with this name already exists', 'error');
                return;
            }
            
            // Create the file
            files[filename] = {
                content: '',
                language: filetype
            };
            
            // Add the file tab
            addFileTab(filename, filetype);
            
            // Switch to the new file
            saveCurrentFile();
            loadFile(filename);
            
            // Close the modal
            document.getElementById('add-file-modal').classList.add('hidden');
            
            // Reset modal animation
            setTimeout(() => {
                document.getElementById('add-file-modal-content').classList.add('scale-95', 'opacity-0');
                document.getElementById('add-file-modal-content').classList.remove('scale-100', 'opacity-100');
            }, 300);
            
            filenameInput.value = '';
            
            showToast(`File "${filename}" created successfully`, 'success');
        }

        function addFileTab(filename, filetype) {
            const fileTabsContainer = document.getElementById('file-tabs-container');
            const addFileBtn = document.getElementById('add-file-btn');
            
            const fileTab = document.createElement('div');
            fileTab.className = 'file-tab clickable flex items-center px-4 py-2 text-sm cursor-pointer';
            fileTab.setAttribute('data-filename', filename);
            fileTab.setAttribute('data-language', filetype);
            
            // Set the icon based on file type
            let iconClass = 'fa-file-code';
            if (filetype === 'html') iconClass = 'fa-html5';
            else if (filetype === 'css') iconClass = 'fa-css3-alt';
            else if (filetype === 'js' || filetype === 'javascript') iconClass = 'fa-js';
            else if (filetype === 'ts' || filetype === 'typescript') iconClass = 'fa-brands fa-node-js';
            else if (filetype === 'py' || filetype === 'python') iconClass = 'fa-brands fa-python';
            else if (filetype === 'json') iconClass = 'fa-brackets-curly';
            else if (filetype === 'xml') iconClass = 'fa-code';
            
            // Set the icon color based on file type
            let iconColor = 'text-gray-500';
            if (filetype === 'html') iconColor = 'text-orange-500';
            else if (filetype === 'css') iconColor = 'text-blue-500';
            else if (filetype === 'js' || filetype === 'javascript') iconColor = 'text-yellow-500';
            else if (filetype === 'ts' || filetype === 'typescript') iconColor = 'text-blue-400';
            else if (filetype === 'py' || filetype === 'python') iconColor = 'text-green-500';
            else if (filetype === 'json') iconColor = 'text-amber-500';
            else if (filetype === 'xml') iconColor = 'text-green-500';
            
            const iconPrefix = filetype === 'html' || filetype === 'css' || filetype === 'js' || filetype === 'javascript' || filetype === 'ts' || filetype === 'typescript' || filetype === 'py' || filetype === 'python' ? 'fab' : 'fas';
            
            fileTab.innerHTML = `
                <i class="${iconPrefix} ${iconClass} mr-2 ${iconColor}"></i>
                <span>${filename}</span>
                <button class="ml-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 clickable">
                    <i class="fas fa-times text-xs"></i>
                </button>
            `;
            
            fileTabsContainer.insertBefore(fileTab, addFileBtn);
            
            // Add entrance animation
            fileTab.style.opacity = '0';
            fileTab.style.transform = 'translateY(-10px)';
            fileTab.style.transition = 'opacity 0.3s, transform 0.3s';
            
            setTimeout(() => {
                fileTab.style.opacity = '1';
                fileTab.style.transform = 'translateY(0)';
            }, 10);
        }

        function loadFile(filename) {
            // Update the current file
            currentFile = filename;
            
            // Update the editor content
            codeMirrorEditor.setValue(files[filename].content);
            
            // Update the language selector
            document.getElementById('language-selector').value = files[filename].language;
            
            // Update the CodeMirror mode
            updateCodeMirrorMode(files[filename].language);
            
            // Update the active tab
            const fileTabs = document.querySelectorAll('.file-tab');
            fileTabs.forEach(tab => {
                if (tab.getAttribute('data-filename') === filename) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            // Update counts
            updateCharCount();
            updateLineCount();
            
            // Clear error highlighting
            const lineCount = codeMirrorEditor.lineCount();
            for (let i = 0; i < lineCount; i++) {
                codeMirrorEditor.removeLineClass(i, 'background', 'bg-red-100');
            }
        }

        function saveCurrentFile() {
            const content = codeMirrorEditor.getValue();
            files[currentFile].content = content;
        }

        function deleteFile(filename) {
            // Remove the file from the files object
            delete files[filename];
            
            // Remove the file tab with animation
            const fileTab = document.querySelector(`.file-tab[data-filename="${filename}"]`);
            
            // Fade out animation
            fileTab.style.opacity = '0';
            fileTab.style.transform = 'translateY(-10px)';
            
            // After animation completes, remove the element
            setTimeout(() => {
                fileTab.remove();
                
                // If the current file was deleted, load the first available file
                if (filename === currentFile) {
                    const firstFile = Object.keys(files)[0];
                    loadFile(firstFile);
                }
            }, 300);
            
            showToast(`File "${filename}" deleted`, 'info');
        }

        function formatCode() {
            const language = files[currentFile].language;
            const code = codeMirrorEditor.getValue();
            
            let formattedCode = code;
            
            // Show a temporary "Formatting..." toast
            const formattingToast = showToast('Formatting code...', 'info', 0);
            
            setTimeout(() => {
                try {
                    // Basic indentation for HTML
                    if (language === 'html') {
                        formattedCode = formatHTML(formattedCode);
                    }
                    // Basic indentation for CSS
                    else if (language === 'css') {
                        formattedCode = formatCSS(formattedCode);
                    }
                    // Basic indentation for JS/TS
                    else if (language === 'javascript' || language === 'js' || language === 'typescript' || language === 'ts') {
                        formattedCode = formatJS(formattedCode);
                    }
                    // JSON formatting
                    else if (language === 'json') {
                        try {
                            const jsonObj = JSON.parse(formattedCode);
                            formattedCode = JSON.stringify(jsonObj, null, 2);
                        } catch (error) {
                            removeToast(formattingToast);
                            showToast('Cannot format invalid JSON', 'error');
                            return;
                        }
                    }
                    
                    // Set the formatted code
                    codeMirrorEditor.setValue(formattedCode);
                    saveCurrentFile();
                    
                    // Remove formatting toast and show success
                    removeToast(formattingToast);
                    showToast('Code formatted successfully!');
                } catch (error) {
                    removeToast(formattingToast);
                    showToast('Error formatting code: ' + error.message, 'error');
                }
            }, 300);
        }

        function formatHTML(code) {
            // Very simple HTML formatter
            let formatted = '';
            let indent = 0;
            const lines = code.split('\n');
            
            for (let i = 0; i < lines.length; i++) {
                let line = lines[i].trim();
                
                // Decrease indent for closing tags
                if (line.match(/^<\/[^>]+>/) && indent > 0) {
                    indent--;
                }
                
                // Add the line with proper indentation
                if (line.length > 0) {
                    formatted += ' '.repeat(indent * 2) + line + '\n';
                } else {
                    formatted += '\n';
                }
                
                // Increase indent for opening tags (but not self-closing ones)
                if (line.match(/^<[^\/][^>]*>(?!.*<\/[^>]+>)/) && !line.match(/\/>/)) {
                    indent++;
                }
            }
            
            return formatted.trim();
        }

        function formatCSS(code) {
            // Simple CSS formatter
            let formatted = '';
            let indentLevel = 0;
            
            // Remove extra spaces and line breaks
            code = code.replace(/[\r\n\s]+/g, ' ').trim();
            
            // Add line breaks after each rule
            code = code.replace(/}/g, '}\n');
            
            // Process each character
            for (let i = 0; i < code.length; i++) {
                const char = code[i];
                
                if (char === '{') {
                    formatted += ' {\n';
                    indentLevel++;
                    formatted += ' '.repeat(indentLevel * 2);
                } else if (char === ';') {
                    formatted += ';\n' + ' '.repeat(indentLevel * 2);
                } else if (char === '}') {
                    formatted = formatted.trimEnd() + '\n';
                    indentLevel = Math.max(0, indentLevel - 1);
                    formatted += ' '.repeat(indentLevel * 2) + '}';
                } else {
                    formatted += char;
                }
            }
            
            return formatted;
        }

        function formatJS(code) {
            // Simple JS formatter
            let formatted = '';
            let indentLevel = 0;
            let inString = false;
            let stringChar = '';
            
            for (let i = 0; i < code.length; i++) {
                const char = code[i];
                
                // Handle strings
                if ((char === '"' || char === "'" || char === '`') && (i === 0 || code[i - 1] !== '\\')) {
                    if (inString && stringChar === char) {
                        inString = false;
                    } else if (!inString) {
                        inString = true;
                        stringChar = char;
                    }
                    formatted += char;
                    continue;
                }
                
                if (inString) {
                    formatted += char;
                    continue;
                }
                
                // Handle brackets
                if (char === '{') {
                    formatted += ' {\n' + ' '.repeat((indentLevel + 1) * 2);
                    indentLevel++;
                } else if (char === '}') {
                    indentLevel = Math.max(0, indentLevel - 1);
                    formatted = formatted.trimEnd() + '\n' + ' '.repeat(indentLevel * 2) + '}';
                } else if (char === ';') {
                    formatted += ';\n' + ' '.repeat(indentLevel * 2);
                } else if (char === '\n') {
                    formatted += '\n' + ' '.repeat(indentLevel * 2);
                } else {
                    formatted += char;
                }
            }
            
            return formatted;
        }

        function validateHTML() {
            const code = codeMirrorEditor.getValue();
            let hasErrors = false;
            
            // Show a temporary "Validating..." toast
            const validatingToast = showToast('Validating HTML...', 'info', 0);
            
            setTimeout(() => {
                try {
                    // Simple HTML validation
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(code, 'text/html');
                    const errors = doc.querySelectorAll('parsererror');
                    
                    clearConsole();
                    console.info('🔍 Validating HTML...');
                    
                    if (errors.length) {
                        hasErrors = true;
                        errors.forEach(error => {
                            console.error('❌ Parse Error:', error.textContent);
                        });
                    }
                    
                    // Check for unclosed tags
                    const tags = code.match(/<[^\/][^>]*>/g) || [];
                    const closingTags = code.match(/<\/[^>]+>/g) || [];
                    
                    if (tags.length !== closingTags.length) {
                        hasErrors = true;
                        console.warn('⚠️ Warning: Possible unclosed tags detected');
                    }
                    
                    // Switch to console tab with animation
                    const consoleTab = document.querySelector('.code-tab[data-target="console-section"]');
                    consoleTab.classList.add('bouncy');
                    setTimeout(() => consoleTab.classList.remove('bouncy'), 600);
                    consoleTab.click();
                    
                    // Remove validating toast
                    removeToast(validatingToast);
                    
                    if (!hasErrors) {
                        console.info('✅ HTML validation completed: No errors found');
                        showToast('HTML validation passed!', 'success');
                    } else {
                        showToast('HTML validation found issues. Check console.', 'error');
                    }
                } catch (error) {
                    removeToast(validatingToast);
                    showToast('Error validating HTML: ' + error.message, 'error');
                }
            }, 600);
        }

        function minifyCode() {
            const language = files[currentFile].language;
            let code = codeMirrorEditor.getValue();
            
            // Show a temporary "Minifying..." toast
            const minifyingToast = showToast('Minifying code...', 'info', 0);
            
            setTimeout(() => {
                try {
                    // Backup the original code
                    const originalCode = code;
                    
                    if (language === 'html') {
                        // Simple HTML minification
                        code = code.replace(/<!--.*?-->/gs, ''); // Remove comments
                        code = code.replace(/\s+/g, ' '); // Collapse whitespace
                        code = code.replace(/>\s+</g, '><'); // Remove whitespace between tags
                        code = code.trim();
                    } else if (language === 'css') {
                        // Simple CSS minification
                        code = code.replace(/\/\*.*?\*\//gs, ''); // Remove comments
                        code = code.replace(/\s+/g, ' '); // Collapse whitespace
                        code = code.replace(/\s*({|}|;|:|,)\s*/g, '$1'); // Remove whitespace around special chars
                        code = code.replace(/;}/g, '}'); // Remove trailing semicolons
                        code = code.trim();
                    } else if (language === 'javascript' || language === 'js') {
                        // Simple JS minification (warning: this is very basic)
                        code = code.replace(/\/\/.*$/gm, ''); // Remove line comments
                        code = code.replace(/\/\*.*?\*\//gs, ''); // Remove block comments
                        code = code.replace(/\s+/g, ' '); // Collapse whitespace
                        code = code.replace(/\s*({|}|;|:|,|\+|-|\*|\/|=|\?|\|\||&&)\s*/g, '$1'); // Remove whitespace around special chars
                        code = code.trim();
                    } else if (language === 'json') {
                        try {
                            code = JSON.stringify(JSON.parse(code));
                        } catch (error) {
                            removeToast(minifyingToast);
                            showToast('Cannot minify invalid JSON', 'error');
                            return;
                        }
                    } else {
                        removeToast(minifyingToast);
                        showToast('Minification not supported for this file type', 'error');
                        return;
                    }
                    
                    // Calculate size reduction
                    const originalSize = originalCode.length;
                    const minifiedSize = code.length;
                    const reduction = Math.round((1 - minifiedSize / originalSize) * 100);
                    
                    // Update the editor
                    codeMirrorEditor.setValue(code);
                    saveCurrentFile();
                    updateCharCount();
                    updateLineCount();
                    
                    // Remove minifying toast
                    removeToast(minifyingToast);
                    showToast(`Code minified: ${reduction}% size reduction`, 'success');
                } catch (error) {
                    removeToast(minifyingToast);
                    showToast('Error minifying code: ' + error.message, 'error');
                }
            }, 500);
        }

        function animateButton(buttonId) {
            const button = document.getElementById(buttonId);
            if (!button) return;
            
            button.classList.add('bouncy');
            setTimeout(() => {
                button.classList.remove('bouncy');
            }, 600);
        }

        function showToast(message, type = 'success', duration = 3000) {
            const toastContainer = document.getElementById('toast-container');
            
            // Create toast element
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.id = 'toast-' + Date.now();
            
            // Set icon based on type
            let icon = '<i class="fas fa-check-circle mr-2"></i>';
            if (type === 'error') icon = '<i class="fas fa-exclamation-circle mr-2 text-red-500"></i>';
            else if (type === 'info') icon = '<i class="fas fa-info-circle mr-2 text-blue-500"></i>';
            else if (type === 'warning') icon = '<i class="fas fa-exclamation-triangle mr-2 text-yellow-500"></i>';
            
            // Set border color based on type
            if (type === 'error') toast.style.borderLeft = '4px solid #EF4444';
            else if (type === 'info') toast.style.borderLeft = '4px solid #3B82F6';
            else if (type === 'warning') toast.style.borderLeft = '4px solid #F59E0B';
            else toast.style.borderLeft = '4px solid #10B981';
            
            toast.innerHTML = `
                ${icon}
                <span>${message}</span>
            `;
            
            // Add to document
            toastContainer.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // Remove after duration
            if (duration > 0) {
                setTimeout(() => {
                    removeToast(toast);
                }, duration);
            }
            
            return toast;
        }

        function removeToast(toast) {
            if (!toast) return;
            
            // Get the toast element
            const toastElement = typeof toast === 'string' ? document.getElementById(toast) : toast;
            
            if (!toastElement) return;
            
            // Animate out
            toastElement.classList.remove('show');
            
            // Remove after animation
            setTimeout(() => {
                toastElement.remove();
            }, 300);
        }

        function escapeHTML(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        // Implement scroll position saving functionality
        function saveScrollPosition() {
            const outputDisplay = document.getElementById('output-display');
            const previewFrame = document.getElementById('preview-frame');
            
            if (!outputDisplay) return;
            
            // Store current scroll positions
            localStorage.setItem('outputScrollTop', outputDisplay.scrollTop);
            localStorage.setItem('outputScrollLeft', outputDisplay.scrollLeft);
            
            // If there's an iframe, store its scroll position too
            if (previewFrame && previewFrame.contentWindow) {
                try {
                    const frameDoc = previewFrame.contentDocument || previewFrame.contentWindow.document;
                    localStorage.setItem('iframeScrollTop', frameDoc.documentElement.scrollTop || frameDoc.body.scrollTop);
                    localStorage.setItem('iframeScrollLeft', frameDoc.documentElement.scrollLeft || frameDoc.body.scrollLeft);
                } catch (e) {
                    console.warn('Could not save iframe scroll position:', e);
                }
            }
        }

        function restoreScrollPosition() {
            const outputDisplay = document.getElementById('output-display');
            const previewFrame = document.getElementById('preview-frame');
            
            if (!outputDisplay) return;
            
            // Restore container scroll positions
            const outputScrollTop = localStorage.getItem('outputScrollTop');
            const outputScrollLeft = localStorage.getItem('outputScrollLeft');
            
            if (outputScrollTop) outputDisplay.scrollTop = parseInt(outputScrollTop);
            if (outputScrollLeft) outputDisplay.scrollLeft = parseInt(outputScrollLeft);
            
            // If there's an iframe, restore its scroll position too
            if (previewFrame) {
                previewFrame.addEventListener('load', () => {
                    try {
                        const frameDoc = previewFrame.contentDocument || previewFrame.contentWindow.document;
                        const iframeScrollTop = localStorage.getItem('iframeScrollTop');
                        const iframeScrollLeft = localStorage.getItem('iframeScrollLeft');
                        
                        if (iframeScrollTop) frameDoc.documentElement.scrollTop = frameDoc.body.scrollTop = parseInt(iframeScrollTop);
                        if (iframeScrollLeft) frameDoc.documentElement.scrollLeft = frameDoc.body.scrollLeft = parseInt(iframeScrollLeft);
                    } catch (e) {
                        console.warn('Could not restore iframe scroll position:', e);
                    }
                });
            }
        }

        // Add save scroll position to refresh button too
        document.getElementById('refresh-btn').addEventListener('click', saveScrollPosition);

        // Restore scroll position on page load and after code runs
        window.addEventListener('load', restoreScrollPosition);
    </script>
</body>
</html>
